<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn & Grow - Math & Reading Practice (Levels C & D)</title>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --accent: #FFE66D;
            --success: #95E1D3;
            --purple: #A8E6CF;
            --orange: #FFB347;
            --bg-main: #FFF9F0;
            --text-dark: #2C3E50;
            --text-light: #7F8C8D;
            --shadow: 0 8px 24px rgba(0,0,0,0.12);
            --shadow-sm: 0 4px 12px rgba(0,0,0,0.08);
        }

        body {
            font-family: 'Baloo 2', cursive;
            background: linear-gradient(135deg, #FFF9F0 0%, #FFE8D6 100%);
            min-height: 100vh;
            color: var(--text-dark);
            padding: 20px;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: 3em;
            color: var(--primary);
            text-shadow: 3px 3px 0 var(--accent);
            margin-bottom: 10px;
            font-weight: 800;
        }

        .header p {
            font-size: 1.2em;
            color: var(--text-light);
        }

        .student-selector {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .student-selector h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .grade-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .grade-btn {
            flex: 1;
            min-width: 200px;
            padding: 30px;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--purple) 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.3em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            font-family: 'Baloo 2', cursive;
        }

        .grade-btn:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .grade-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--orange) 100%);
            transform: scale(1.05);
        }

        .subject-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease-out 0.4s both;
        }

        .subject-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            border: 3px solid transparent;
        }

        .subject-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow);
        }

        .subject-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, #FFF 0%, #FFE8D6 100%);
        }

        .subject-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .subject-card h3 {
            font-size: 1.5em;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .subject-card p {
            color: var(--text-light);
        }

        .worksheet-selector {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease-out 0.6s both;
        }

        .worksheet-selector h3 {
            color: var(--secondary);
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .sublevel-section {
            margin-bottom: 25px;
        }

        .sublevel-title {
            font-size: 1.2em;
            color: var(--text-dark);
            margin-bottom: 15px;
            font-weight: 700;
            padding: 15px;
            background: linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%);
            border-radius: 10px;
        }

        .worksheet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }

        .worksheet-btn {
            padding: 15px;
            background: linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%);
            border: 3px solid #DEE2E6;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Baloo 2', cursive;
            color: var(--text-dark);
        }

        .worksheet-btn:hover {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--purple) 100%);
            color: white;
            border-color: var(--secondary);
            transform: scale(1.05);
        }

        .worksheet-btn.completed {
            background: linear-gradient(135deg, var(--success) 0%, var(--purple) 100%);
            color: white;
            border-color: var(--success);
        }

        .worksheet-area {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease-out 0.6s both;
        }

        .worksheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .worksheet-title {
            font-size: 2em;
            color: var(--primary);
            font-weight: 700;
        }

        .progress-container {
            flex: 1;
            min-width: 200px;
        }

        .progress-label {
            font-size: 0.9em;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 20px;
            background: #E8E8E8;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary) 0%, var(--success) 100%);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .stars-earned {
            text-align: center;
            font-size: 2em;
            margin-top: 10px;
        }

        .drawing-tools {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .drawing-tools h4 {
            margin: 0;
            color: var(--text-dark);
            font-size: 1.2em;
        }

        .tool-btn {
            padding: 10px 20px;
            border: 2px solid #DEE2E6;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-family: 'Baloo 2', cursive;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tool-btn:hover {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .tool-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .color-picker {
            width: 50px;
            height: 40px;
            border: 2px solid #DEE2E6;
            border-radius: 8px;
            cursor: pointer;
        }

        .canvas-container {
            position: relative;
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }

        #scratchCanvas {
            border: 2px dashed #DEE2E6;
            border-radius: 10px;
            cursor: crosshair;
            touch-action: none;
            background: #FFFEF9;
            width: 100%;
            max-width: 100%;
        }

        .question-card {
            background: linear-gradient(135deg, #F8F9FA 0%, #FFFFFF 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            border-left: 5px solid var(--secondary);
            transition: all 0.3s ease;
        }

        .question-card:hover {
            box-shadow: var(--shadow-sm);
            transform: translateX(5px);
        }

        .question-number {
            display: inline-block;
            background: var(--accent);
            color: var(--text-dark);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .question-text {
            font-size: 1.3em;
            color: var(--text-dark);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #E8E8E8;
            border-radius: 10px;
            font-family: 'Comic Neue', cursive;
            transition: all 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        .answer-input.correct {
            border-color: var(--success);
            background: #F0FFF4;
        }

        .answer-input.incorrect {
            border-color: var(--primary);
            background: #FFF5F5;
        }

        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .option-btn {
            padding: 20px;
            background: white;
            border: 3px solid #E8E8E8;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Baloo 2', cursive;
            font-weight: 600;
        }

        .option-btn:hover {
            border-color: var(--secondary);
            transform: scale(1.05);
        }

        .option-btn.selected {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .option-btn.correct {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .option-btn.incorrect {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 18px 40px;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Baloo 2', cursive;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--purple) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: white;
            color: var(--text-dark);
            border: 3px solid var(--secondary);
        }

        .btn-secondary:hover {
            background: var(--secondary);
            color: white;
        }

        .feedback-message {
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            font-size: 1.1em;
            font-weight: 600;
            text-align: center;
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .feedback-message.correct {
            background: var(--success);
            color: white;
        }

        .feedback-message.incorrect {
            background: #FFE8E8;
            color: var(--primary);
        }

        .completion-screen {
            text-align: center;
            padding: 60px 20px;
        }

        .completion-screen h2 {
            font-size: 3em;
            color: var(--primary);
            margin-bottom: 20px;
            animation: bounceIn 0.8s ease;
        }

        .score-display {
            font-size: 4em;
            color: var(--secondary);
            margin: 30px 0;
            font-weight: 800;
            animation: bounceIn 1s ease 0.2s both;
        }

        .star-animation {
            font-size: 6em;
            margin: 20px 0;
            animation: starPulse 1.5s ease infinite;
        }

        @keyframes starPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }

        .reading-passage {
            background: #FFFEF9;
            border: 3px solid var(--accent);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            line-height: 2;
            font-size: 1.15em;
            font-family: 'Comic Neue', cursive;
        }

        .reading-passage h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .reading-passage p {
            margin-bottom: 20px;
            color: var(--text-dark);
        }

        .hidden {
            display: none;
        }

        .study-records {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease-out 0.6s both;
        }

        .study-records h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            font-size: 2em;
            text-align: center;
        }

        .records-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .tab-btn {
            padding: 15px 30px;
            background: #F8F9FA;
            border: 3px solid #DEE2E6;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Baloo 2', cursive;
        }

        .tab-btn:hover {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%);
            border-radius: 15px;
        }

        .calendar-nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-btn {
            padding: 10px 20px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Baloo 2', cursive;
        }

        .nav-btn:hover {
            background: var(--primary);
            transform: scale(1.05);
        }

        .month-year {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--text-dark);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 700;
            padding: 15px;
            background: var(--accent);
            border-radius: 10px;
            color: var(--text-dark);
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 3px solid #E9ECEF;
            border-radius: 12px;
            padding: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .calendar-day:hover {
            border-color: var(--secondary);
            transform: scale(1.05);
            box-shadow: var(--shadow-sm);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            border-color: var(--primary);
            background: linear-gradient(135deg, #FFF 0%, #FFE8D6 100%);
        }

        .calendar-day.has-progress {
            border-color: var(--success);
            background: linear-gradient(135deg, #FFF 0%, #F0FFF4 100%);
        }

        .day-number {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .day-stats {
            font-size: 0.75em;
            text-align: center;
            color: var(--text-light);
        }

        .day-stats .sheets {
            color: var(--secondary);
            font-weight: 700;
        }

        .day-stats .percentage {
            color: var(--primary);
            font-weight: 700;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--purple) 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }

        .stat-card h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .stat-value {
            font-size: 2.5em;
            font-weight: 800;
        }

        .day-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            animation: bounceIn 0.5s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: var(--primary);
            font-size: 1.8em;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: var(--primary);
            transform: scale(1.2);
        }

        .worksheet-list {
            margin-top: 20px;
        }

        .worksheet-item {
            background: #F8F9FA;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .worksheet-item .name {
            font-weight: 700;
            color: var(--text-dark);
        }

        .worksheet-item .score {
            font-weight: 700;
            font-size: 1.2em;
        }

        .worksheet-item .score.perfect {
            color: var(--success);
        }

        .worksheet-item .score.good {
            color: var(--secondary);
        }

        .worksheet-item .score.needs-work {
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .worksheet-header {
                flex-direction: column;
            }
            
            .grade-buttons {
                flex-direction: column;
            }
            
            .subject-selector {
                grid-template-columns: 1fr;
            }

            .worksheet-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }

            .drawing-tools {
                flex-direction: column;
                align-items: stretch;
            }

            #scratchCanvas {
                width: 100%;
            }

            .calendar-grid {
                gap: 5px;
            }

            .calendar-day {
                padding: 5px;
                font-size: 0.85em;
            }

            .day-stats {
                font-size: 0.65em;
            }

            .stats-summary {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>üìö Learn & Grow üåü</h1>
            <p>Levels C, D & E (5th-7th Grade) - Practice makes perfect!</p>
            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="showStudyRecords()" style="font-size: 1em; padding: 12px 30px;">
                    üìä View Study Records
                </button>
            </div>
        </div>

        <div class="student-selector">
            <h2>Select Your Level</h2>
            <div class="grade-buttons">
                <button class="grade-btn" onclick="selectGrade('C')">
                    üéØ Level C (5th Grade)<br>
                    <small style="font-size: 0.8em; opacity: 0.9;">Multiplication & Division</small>
                </button>
                <button class="grade-btn" onclick="selectGrade('D')">
                    üöÄ Level D (6th Grade)<br>
                    <small style="font-size: 0.8em; opacity: 0.9;">Long Division, Fractions & Decimals</small>
                </button>
                <button class="grade-btn" onclick="selectGrade('E')">
                    ‚≠ê Level E (7th Grade)<br>
                    <small style="font-size: 0.8em; opacity: 0.9;">Fractions & Decimals</small>
                </button>
            </div>
        </div>

        <div id="studyRecords" class="study-records hidden">
            <h2>üìä Study Records</h2>
            
            <div class="records-tabs">
                <button class="tab-btn active" onclick="switchRecordsTab('C-math')">Level C Math</button>
                <button class="tab-btn" onclick="switchRecordsTab('D-math')">Level D Math</button>
                <button class="tab-btn" onclick="switchRecordsTab('E-math')">Level E Math</button>
                <button class="tab-btn" onclick="switchRecordsTab('C-reading')">Level C Reading</button>
                <button class="tab-btn" onclick="switchRecordsTab('D-reading')">Level D Reading</button>
                <button class="tab-btn" onclick="switchRecordsTab('E-reading')">Level E Reading</button>
            </div>

            <div class="calendar-header">
                <button class="nav-btn" onclick="changeMonth(-1)">‚óÄ Previous</button>
                <div class="month-year" id="monthYear"></div>
                <button class="nav-btn" onclick="changeMonth(1)">Next ‚ñ∂</button>
            </div>

            <div class="calendar-grid" id="calendarGrid"></div>

            <div class="stats-summary" id="statsSummary"></div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="closeStudyRecords()">Back to Practice</button>
            </div>
        </div>

        <div id="subjectSelector" class="subject-selector hidden">
            <div class="subject-card" onclick="selectSubject('math')">
                <div class="subject-icon">üî¢</div>
                <h3>Math Practice</h3>
                <p>Numbers, operations, and problem solving</p>
            </div>
            <div class="subject-card" onclick="selectSubject('reading')">
                <div class="subject-icon">üìñ</div>
                <h3>Reading Practice</h3>
                <p>Comprehension and vocabulary</p>
            </div>
        </div>

        <div id="worksheetSelector" class="worksheet-selector hidden">
            <h3>Select a Worksheet</h3>
            <div id="worksheetList"></div>
        </div>

        <div id="worksheetArea" class="worksheet-area hidden">
            <div class="worksheet-header">
                <div class="worksheet-title" id="worksheetTitle"></div>
                <div class="progress-container">
                    <div class="progress-label">Progress: <span id="progressText">0/10</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="stars-earned" id="starsEarned"></div>
                </div>
            </div>

            <div class="drawing-tools">
                <h4>‚úèÔ∏è Scratch Paper:</h4>
                <button class="tool-btn active" onclick="setDrawingTool('pen')" id="penBtn">Pen</button>
                <button class="tool-btn" onclick="setDrawingTool('eraser')" id="eraserBtn">Eraser</button>
                <input type="color" class="color-picker" id="colorPicker" value="#2C3E50" onchange="setDrawingColor(this.value)">
                <button class="tool-btn" onclick="clearCanvas()">Clear All</button>
                <label style="display: flex; align-items: center; gap: 10px;">
                    <span>Line Width:</span>
                    <input type="range" min="1" max="10" value="3" id="lineWidth" onchange="setLineWidth(this.value)" style="width: 100px;">
                </label>
            </div>

            <div class="canvas-container">
                <canvas id="scratchCanvas" width="800" height="400"></canvas>
            </div>

            <div id="questionsContainer"></div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="checkAnswers()">Check My Answers ‚úì</button>
                <button class="btn btn-secondary" onclick="backToWorksheetList()">Choose Another Worksheet üìã</button>
                <button class="btn btn-secondary" onclick="backToMenu()">Back to Menu üè†</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentGrade = null;
        let currentSubject = null;
        let currentSublevel = null;
        let currentWorksheetNum = null;
        let currentQuestions = [];
        let userAnswers = {};
        let checkedOnce = false;
        let completedWorksheets = {};

        // Study records state
        let studyRecords = {
            'C-math': {},
            'D-math': {},
            'E-math': {},
            'C-reading': {},
            'D-reading': {},
            'E-reading': {}
        };
        let currentRecordsTab = 'C-math';
        let currentCalendarDate = new Date();

        // Load study records from localStorage
        function loadStudyRecords() {
            const saved = localStorage.getItem('kumonStudyRecords');
            if (saved) {
                try {
                    studyRecords = JSON.parse(saved);
                } catch (e) {
                    console.error('Error loading study records:', e);
                }
            }
        }

        // Save study records to localStorage
        function saveStudyRecords() {
            try {
                localStorage.setItem('kumonStudyRecords', JSON.stringify(studyRecords));
            } catch (e) {
                console.error('Error saving study records:', e);
            }
        }

        // Record a completed worksheet
        function recordWorksheet(grade, subject, sublevel, worksheetNum, score, total) {
            const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
            const recordKey = `${grade}-${subject}`;
            
            if (!studyRecords[recordKey]) {
                studyRecords[recordKey] = {};
            }
            
            if (!studyRecords[recordKey][today]) {
                studyRecords[recordKey][today] = [];
            }
            
            studyRecords[recordKey][today].push({
                grade: grade,
                sublevel: sublevel,
                worksheet: worksheetNum,
                score: score,
                total: total,
                percentage: Math.round((score / total) * 100),
                timestamp: new Date().toISOString()
            });
            
            saveStudyRecords();
        }

        // Drawing canvas variables
        let canvas, ctx;
        let isDrawing = false;
        let currentTool = 'pen';
        let currentColor = '#2C3E50';
        let lineWidth = 3;

        // Initialize canvas
        function initCanvas() {
            canvas = document.getElementById('scratchCanvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas size based on container
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth - 40;
            canvas.width = Math.min(800, containerWidth);
            canvas.height = 400;
            
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            ctx.lineWidth = lineWidth;
            ctx.strokeStyle = currentTool === 'eraser' ? '#FFFEF9' : currentColor;
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function setDrawingTool(tool) {
            currentTool = tool;
            document.getElementById('penBtn').classList.toggle('active', tool === 'pen');
            document.getElementById('eraserBtn').classList.toggle('active', tool === 'eraser');
        }

        function setDrawingColor(color) {
            currentColor = color;
        }

        function setLineWidth(width) {
            lineWidth = width;
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Helper function for GCD (Greatest Common Divisor)
        function gcd(a, b) {
            a = Math.abs(a);
            b = Math.abs(b);
            return b === 0 ? a : gcd(b, a % b);
        }

        // Comprehensive worksheet data - 10 worksheets per sublevel
        const mathWorksheets = {
            'C': {
                'Tables': generateTablesWorksheets(),
                'Multi-digit': generateMultiDigitWorksheets(),
                'Division': generateDivisionWorksheets()
            },
            'D': {
                'Long Division': generateLongDivisionWorksheets(),
                'Fractions': generateFractionsWorksheets(),
                'Multiplication & Decimals': generateMultiplicationDecimalsWorksheets()
            },
            'E': {
                'Addition & Subtraction of Fractions': generateFractionAddSubWorksheets(),
                'Multiplication & Division of Fractions': generateFractionMultDivWorksheets(),
                'Decimals': generateDecimalsWorksheets()
            }
        };

        function generateTablesWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-10: 2-5 tables (easier)
            for (let w = 1; w <= 10; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 4) + 2; // 2-5
                    const num2 = Math.floor(Math.random() * 9) + 2; // 2-10
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 11-20: 2-7 tables (medium)
            for (let w = 11; w <= 20; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 6) + 2; // 2-7
                    const num2 = Math.floor(Math.random() * 9) + 2; // 2-10
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 21-30: 2-9 tables (harder)
            for (let w = 21; w <= 30; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 8) + 2; // 2-9
                    const num2 = Math.floor(Math.random() * 9) + 2; // 2-10
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 31-40: All tables with larger multipliers
            for (let w = 31; w <= 40; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 8) + 2; // 2-9
                    const num2 = Math.floor(Math.random() * 10) + 2; // 2-11
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 41-50: Speed challenge - all tables, random order
            for (let w = 41; w <= 50; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 8) + 2; // 2-9
                    const num2 = Math.floor(Math.random() * 10) + 2; // 2-11
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        function generateMultiDigitWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-10: 2-digit √ó 1-digit (small numbers, no/minimal carrying)
            for (let w = 1; w <= 10; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 30) + 11; // 11-40
                    const num2 = Math.floor(Math.random() * 3) + 2; // 2-4
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 11-20: 2-digit √ó 1-digit (medium, with carrying)
            for (let w = 11; w <= 20; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 60) + 20; // 20-79
                    const num2 = Math.floor(Math.random() * 5) + 3; // 3-7
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 21-30: 2-digit √ó 1-digit (larger, more carrying)
            for (let w = 21; w <= 30; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 90) + 10; // 10-99
                    const num2 = Math.floor(Math.random() * 7) + 3; // 3-9
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 31-40: 3-digit √ó 1-digit
            for (let w = 31; w <= 40; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 700) + 100; // 100-799
                    const num2 = Math.floor(Math.random() * 7) + 3; // 3-9
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 41-50: Large 3-digit √ó 1-digit (challenge)
            for (let w = 41; w <= 50; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 900) + 100; // 100-999
                    const num2 = Math.floor(Math.random() * 8) + 2; // 2-9
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        function generateDivisionWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-10: Simple division facts (reverse of multiplication, no remainders)
            for (let w = 1; w <= 10; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 5) + 3; // 3-7
                    const quotient = Math.floor(Math.random() * 8) + 2; // 2-9
                    const dividend = divisor * quotient;
                    ws.push({ q: `${dividend} √∑ ${divisor} = ?`, a: String(quotient) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 11-20: Division with small remainders
            for (let w = 11; w <= 20; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 5) + 4; // 4-8
                    const quotient = Math.floor(Math.random() * 10) + 3; // 3-12
                    const remainder = Math.floor(Math.random() * (divisor - 1)) + 1;
                    const dividend = divisor * quotient + remainder;
                    ws.push({ 
                        q: `${dividend} √∑ ${divisor} = ? (answer as: quotient r remainder)`, 
                        a: `${quotient} r ${remainder}` 
                    });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 21-30: Medium difficulty with larger dividends
            for (let w = 21; w <= 30; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 6) + 5; // 5-10
                    const quotient = Math.floor(Math.random() * 15) + 5; // 5-19
                    const remainder = Math.floor(Math.random() * divisor);
                    const dividend = divisor * quotient + remainder;
                    if (remainder === 0) {
                        ws.push({ q: `${dividend} √∑ ${divisor} = ?`, a: String(quotient) });
                    } else {
                        ws.push({ 
                            q: `${dividend} √∑ ${divisor} = ? (answer as: quotient r remainder)`, 
                            a: `${quotient} r ${remainder}` 
                        });
                    }
                }
                worksheets.push(ws);
            }
            
            // Worksheets 31-40: Larger dividends, preparing for long division
            for (let w = 31; w <= 40; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 7) + 6; // 6-12
                    const quotient = Math.floor(Math.random() * 20) + 10; // 10-29
                    const remainder = Math.floor(Math.random() * divisor);
                    const dividend = divisor * quotient + remainder;
                    if (remainder === 0) {
                        ws.push({ q: `${dividend} √∑ ${divisor} = ?`, a: String(quotient) });
                    } else {
                        ws.push({ 
                            q: `${dividend} √∑ ${divisor} = ? (answer as: quotient r remainder)`, 
                            a: `${quotient} r ${remainder}` 
                        });
                    }
                }
                worksheets.push(ws);
            }
            
            // Worksheets 41-50: Challenging division (3-digit √∑ 1-digit)
            for (let w = 41; w <= 50; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 8) + 2; // 2-9
                    const quotient = Math.floor(Math.random() * 90) + 10; // 10-99
                    const remainder = Math.floor(Math.random() * divisor);
                    const dividend = divisor * quotient + remainder;
                    if (remainder === 0) {
                        ws.push({ q: `${dividend} √∑ ${divisor} = ?`, a: String(quotient) });
                    } else {
                        ws.push({ 
                            q: `${dividend} √∑ ${divisor} = ? (answer as: quotient r remainder)`, 
                            a: `${quotient} r ${remainder}` 
                        });
                    }
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        function generateLongDivisionWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-10: 2-digit √∑ 2-digit (small, no remainder)
            for (let w = 1; w <= 10; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 8) + 11; // 11-18
                    const quotient = Math.floor(Math.random() * 5) + 3; // 3-7
                    const dividend = divisor * quotient;
                    ws.push({ q: `${dividend} √∑ ${divisor} = ?`, a: String(quotient) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 11-20: 3-digit √∑ 2-digit (quotient 10-30)
            for (let w = 11; w <= 20; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 15) + 12; // 12-26
                    const quotient = Math.floor(Math.random() * 21) + 10; // 10-30
                    const dividend = divisor * quotient;
                    ws.push({ q: `${dividend} √∑ ${divisor} = ?`, a: String(quotient) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 21-30: 3-digit √∑ 2-digit (quotient 20-50, with some remainders)
            for (let w = 21; w <= 30; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 20) + 15; // 15-34
                    const quotient = Math.floor(Math.random() * 31) + 20; // 20-50
                    const remainder = i < 5 ? 0 : Math.floor(Math.random() * divisor);
                    const dividend = divisor * quotient + remainder;
                    if (remainder === 0) {
                        ws.push({ q: `${dividend} √∑ ${divisor} = ?`, a: String(quotient) });
                    } else {
                        ws.push({ 
                            q: `${dividend} √∑ ${divisor} = ? (answer as: quotient r remainder)`, 
                            a: `${quotient} r ${remainder}` 
                        });
                    }
                }
                worksheets.push(ws);
            }
            
            // Worksheets 31-40: 3-4 digit √∑ 2-digit (quotient 30-70)
            for (let w = 31; w <= 40; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 25) + 20; // 20-44
                    const quotient = Math.floor(Math.random() * 41) + 30; // 30-70
                    const remainder = i < 4 ? 0 : Math.floor(Math.random() * divisor);
                    const dividend = divisor * quotient + remainder;
                    if (remainder === 0) {
                        ws.push({ q: `${dividend} √∑ ${divisor} = ?`, a: String(quotient) });
                    } else {
                        ws.push({ 
                            q: `${dividend} √∑ ${divisor} = ? (answer as: quotient r remainder)`, 
                            a: `${quotient} r ${remainder}` 
                        });
                    }
                }
                worksheets.push(ws);
            }
            
            // Worksheets 41-50: 4-digit √∑ 2-digit (challenging, like 2093√∑32)
            for (let w = 41; w <= 50; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 40) + 21; // 21-60
                    const quotient = Math.floor(Math.random() * 70) + 30; // 30-99
                    const remainder = i < 3 ? 0 : Math.floor(Math.random() * divisor);
                    const dividend = divisor * quotient + remainder;
                    if (remainder === 0) {
                        ws.push({ q: `${dividend} √∑ ${divisor} = ?`, a: String(quotient) });
                    } else {
                        ws.push({ 
                            q: `${dividend} √∑ ${divisor} = ? (answer as: quotient r remainder)`, 
                            a: `${quotient} r ${remainder}` 
                        });
                    }
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        function generateFractionsWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-15: Simplifying fractions (progressively harder)
            const simplificationSets = [
                // Easy (worksheets 1-5)
                [
                    { orig: '2/4', simp: '1/2' }, { orig: '3/6', simp: '1/2' }, { orig: '4/8', simp: '1/2' },
                    { orig: '2/6', simp: '1/3' }, { orig: '3/9', simp: '1/3' }, { orig: '4/12', simp: '1/3' },
                    { orig: '2/8', simp: '1/4' }, { orig: '3/12', simp: '1/4' }, { orig: '6/8', simp: '3/4' },
                    { orig: '9/12', simp: '3/4' }
                ],
                // Medium (worksheets 6-10)
                [
                    { orig: '6/9', simp: '2/3' }, { orig: '8/12', simp: '2/3' }, { orig: '10/15', simp: '2/3' },
                    { orig: '4/6', simp: '2/3' }, { orig: '6/10', simp: '3/5' }, { orig: '9/15', simp: '3/5' },
                    { orig: '12/16', simp: '3/4' }, { orig: '15/20', simp: '3/4' }, { orig: '10/12', simp: '5/6' },
                    { orig: '12/18', simp: '2/3' }
                ],
                // Harder (worksheets 11-15)
                [
                    { orig: '14/21', simp: '2/3' }, { orig: '18/24', simp: '3/4' }, { orig: '20/30', simp: '2/3' },
                    { orig: '15/25', simp: '3/5' }, { orig: '16/24', simp: '2/3' }, { orig: '18/27', simp: '2/3' },
                    { orig: '20/24', simp: '5/6' }, { orig: '24/32', simp: '3/4' }, { orig: '25/35', simp: '5/7' },
                    { orig: '30/45', simp: '2/3' }
                ]
            ];
            
            for (let setIdx = 0; setIdx < 3; setIdx++) {
                for (let w = 0; w < 5; w++) {
                    const ws = simplificationSets[setIdx].map(f => ({ 
                        q: `Simplify: ${f.orig} (answer as fraction, e.g., 1/2)`, 
                        a: f.simp 
                    }));
                    worksheets.push(ws);
                }
            }
            
            // Worksheets 16-25: Improper to mixed numbers
            for (let w = 16; w <= 25; w++) {
                const ws = [];
                const difficulty = Math.floor((w - 16) / 3); // 0, 1, 2, 3
                for (let i = 0; i < 10; i++) {
                    const denom = [3, 4, 5, 6, 7, 8][Math.floor(Math.random() * (3 + difficulty))];
                    const whole = Math.floor(Math.random() * (3 + difficulty)) + 2;
                    const num = Math.floor(Math.random() * (denom - 1)) + 1;
                    const improper = whole * denom + num;
                    ws.push({ 
                        q: `Convert to mixed number: ${improper}/${denom} (answer as: 2 1/3)`, 
                        a: `${whole} ${num}/${denom}` 
                    });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 26-40: Addition and subtraction of fractions (like denominators)
            for (let w = 26; w <= 40; w++) {
                const ws = [];
                const maxDenom = 6 + Math.floor((w - 26) / 3); // Increasing complexity
                for (let i = 0; i < 10; i++) {
                    const denom = Math.floor(Math.random() * (maxDenom - 4)) + 5;
                    const num1 = Math.floor(Math.random() * (denom - 2)) + 1;
                    const num2 = Math.floor(Math.random() * (denom - num1 - 1)) + 1;
                    const op = Math.random() < 0.5 ? '+' : '-';
                    const result = op === '+' ? num1 + num2 : num1 - num2;
                    if (result > 0 && result < denom) {
                        ws.push({ 
                            q: `${num1}/${denom} ${op} ${num2}/${denom} = ? (answer as fraction)`, 
                            a: `${result}/${denom}` 
                        });
                    } else {
                        i--;
                    }
                }
                worksheets.push(ws);
            }
            
            // Worksheets 41-50: Mixed practice (all skills)
            for (let w = 41; w <= 50; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const skill = Math.floor(Math.random() * 3);
                    if (skill === 0) {
                        // Simplifying
                        const factor = Math.floor(Math.random() * 5) + 2;
                        const num = Math.floor(Math.random() * 8) + 1;
                        const denom = Math.floor(Math.random() * 10) + num + 1;
                        const gcdVal = gcd(num, denom);
                        ws.push({ 
                            q: `Simplify: ${num * factor}/${denom * factor} (answer as fraction)`, 
                            a: `${num / gcdVal}/${denom / gcdVal}` 
                        });
                    } else if (skill === 1) {
                        // Improper to mixed
                        const denom = Math.floor(Math.random() * 6) + 3;
                        const whole = Math.floor(Math.random() * 5) + 2;
                        const num = Math.floor(Math.random() * (denom - 1)) + 1;
                        const improper = whole * denom + num;
                        ws.push({ 
                            q: `Convert: ${improper}/${denom} (answer as: 2 1/3)`, 
                            a: `${whole} ${num}/${denom}` 
                        });
                    } else {
                        // Addition/subtraction
                        const denom = Math.floor(Math.random() * 8) + 5;
                        const num1 = Math.floor(Math.random() * (denom - 2)) + 2;
                        const num2 = Math.floor(Math.random() * (denom - 2)) + 1;
                        if (num1 > num2) {
                            ws.push({ 
                                q: `${num1}/${denom} - ${num2}/${denom} = ? (answer as fraction)`, 
                                a: `${num1 - num2}/${denom}` 
                            });
                        } else {
                            i--;
                        }
                    }
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        function generateMultiplicationDecimalsWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-15: 2-digit √ó 2-digit (increasing difficulty)
            for (let w = 1; w <= 15; w++) {
                const ws = [];
                const minNum = 10 + (w - 1) * 3;
                const maxNum = 30 + (w - 1) * 5;
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * (maxNum - minNum)) + minNum;
                    const num2 = Math.floor(Math.random() * (maxNum - minNum)) + minNum;
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 16-30: 3-digit √ó 2-digit
            for (let w = 16; w <= 30; w++) {
                const ws = [];
                const minNum1 = 100 + (w - 16) * 30;
                const maxNum1 = 300 + (w - 16) * 40;
                const minNum2 = 15 + (w - 16) * 2;
                const maxNum2 = 35 + (w - 16) * 3;
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * (maxNum1 - minNum1)) + minNum1;
                    const num2 = Math.floor(Math.random() * (maxNum2 - minNum2)) + minNum2;
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 31-40: Decimal addition and subtraction
            for (let w = 31; w <= 40; w++) {
                const ws = [];
                const decimalPlaces = w < 36 ? 1 : 2;
                const maxVal = w < 36 ? 100 : 1000;
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.pow(10, decimalPlaces);
                    if (Math.random() < 0.5) {
                        const num1 = Math.floor(Math.random() * maxVal) / divisor;
                        const num2 = Math.floor(Math.random() * maxVal) / divisor;
                        const result = (num1 + num2).toFixed(decimalPlaces);
                        ws.push({ q: `${num1.toFixed(decimalPlaces)} + ${num2.toFixed(decimalPlaces)} = ?`, a: result });
                    } else {
                        const num1 = Math.floor(Math.random() * maxVal + maxVal/2) / divisor;
                        const num2 = Math.floor(Math.random() * maxVal) / divisor;
                        if (num1 > num2) {
                            const result = (num1 - num2).toFixed(decimalPlaces);
                            ws.push({ q: `${num1.toFixed(decimalPlaces)} - ${num2.toFixed(decimalPlaces)} = ?`, a: result });
                        } else {
                            i--;
                        }
                    }
                }
                worksheets.push(ws);
            }
            
            // Worksheets 41-50: Decimal multiplication
            for (let w = 41; w <= 50; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = (Math.floor(Math.random() * 99) + 1) / 10;
                    const num2 = (Math.floor(Math.random() * 99) + 1) / 10;
                    const result = (num1 * num2).toFixed(2);
                    ws.push({ q: `${num1.toFixed(1)} √ó ${num2.toFixed(1)} = ?`, a: result });
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        function generateFractionAddSubWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-25: Addition with unlike denominators (progressively harder)
            for (let w = 1; w <= 25; w++) {
                const ws = [];
                // Determine complexity based on worksheet number
                const maxDenom = Math.min(6 + Math.floor(w / 3), 20);
                const denomPairs = [];
                
                // Generate appropriate denominator pairs for this difficulty level
                for (let d1 = 3; d1 <= maxDenom; d1++) {
                    for (let d2 = d1 + 1; d2 <= maxDenom; d2++) {
                        if (gcd(d1, d2) < Math.max(d1, d2) / 2) {
                            denomPairs.push([d1, d2]);
                        }
                    }
                }
                
                for (let i = 0; i < 10; i++) {
                    const pair = denomPairs[Math.floor(Math.random() * Math.min(denomPairs.length, 20))];
                    const denom1 = pair[0];
                    const denom2 = pair[1];
                    const num1 = Math.floor(Math.random() * (denom1 - 1)) + 1;
                    const num2 = Math.floor(Math.random() * (denom2 - 1)) + 1;
                    
                    // Calculate LCM
                    const lcm = (denom1 * denom2) / gcd(denom1, denom2);
                    const newNum1 = num1 * (lcm / denom1);
                    const newNum2 = num2 * (lcm / denom2);
                    const resultNum = newNum1 + newNum2;
                    
                    // Simplify
                    const divisor = gcd(resultNum, lcm);
                    const finalNum = resultNum / divisor;
                    const finalDenom = lcm / divisor;
                    
                    ws.push({ 
                        q: `${num1}/${denom1} + ${num2}/${denom2} = ? (answer as fraction)`, 
                        a: `${finalNum}/${finalDenom}` 
                    });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 26-50: Subtraction with unlike denominators
            for (let w = 26; w <= 50; w++) {
                const ws = [];
                const maxDenom = Math.min(6 + Math.floor((w - 25) / 3), 20);
                const denomPairs = [];
                
                for (let d1 = 3; d1 <= maxDenom; d1++) {
                    for (let d2 = d1 + 1; d2 <= maxDenom; d2++) {
                        if (gcd(d1, d2) < Math.max(d1, d2) / 2) {
                            denomPairs.push([d1, d2]);
                        }
                    }
                }
                
                for (let i = 0; i < 10; i++) {
                    const pair = denomPairs[Math.floor(Math.random() * Math.min(denomPairs.length, 20))];
                    let denom1 = pair[0];
                    let denom2 = pair[1];
                    
                    // Ensure first fraction is larger
                    const lcm = (denom1 * denom2) / gcd(denom1, denom2);
                    let num1 = Math.floor(Math.random() * (denom1 - 1)) + 2;
                    let num2 = Math.floor(Math.random() * (denom2 - 1)) + 1;
                    
                    const val1 = num1 / denom1;
                    const val2 = num2 / denom2;
                    
                    if (val1 <= val2) {
                        const temp = num1;
                        num1 = num2;
                        num2 = temp;
                        const tempD = denom1;
                        denom1 = denom2;
                        denom2 = tempD;
                    }
                    
                    const newNum1 = num1 * (lcm / denom1);
                    const newNum2 = num2 * (lcm / denom2);
                    const resultNum = newNum1 - newNum2;
                    
                    if (resultNum > 0) {
                        const divisor = gcd(resultNum, lcm);
                        const finalNum = resultNum / divisor;
                        const finalDenom = lcm / divisor;
                        
                        ws.push({ 
                            q: `${num1}/${denom1} - ${num2}/${denom2} = ? (answer as fraction)`, 
                            a: `${finalNum}/${finalDenom}` 
                        });
                    } else {
                        i--;
                    }
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        function generateFractionMultDivWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-25: Multiplication of fractions (progressively harder)
            for (let w = 1; w <= 25; w++) {
                const ws = [];
                const maxDenom = Math.min(4 + Math.floor(w / 2), 15);
                for (let i = 0; i < 10; i++) {
                    const denom1 = Math.floor(Math.random() * (maxDenom - 2)) + 3;
                    const denom2 = Math.floor(Math.random() * (maxDenom - 2)) + 3;
                    const num1 = Math.floor(Math.random() * (denom1 - 1)) + 1;
                    const num2 = Math.floor(Math.random() * (denom2 - 1)) + 1;
                    
                    const resultNum = num1 * num2;
                    const resultDenom = denom1 * denom2;
                    
                    const divisor = gcd(resultNum, resultDenom);
                    const finalNum = resultNum / divisor;
                    const finalDenom = resultDenom / divisor;
                    
                    ws.push({ 
                        q: `${num1}/${denom1} √ó ${num2}/${denom2} = ? (answer as fraction)`, 
                        a: `${finalNum}/${finalDenom}` 
                    });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 26-50: Division of fractions (progressively harder)
            for (let w = 26; w <= 50; w++) {
                const ws = [];
                const maxDenom = Math.min(4 + Math.floor((w - 25) / 2), 15);
                for (let i = 0; i < 10; i++) {
                    const denom1 = Math.floor(Math.random() * (maxDenom - 2)) + 3;
                    const denom2 = Math.floor(Math.random() * (maxDenom - 2)) + 3;
                    const num1 = Math.floor(Math.random() * (denom1 - 1)) + 1;
                    const num2 = Math.floor(Math.random() * (denom2 - 1)) + 1;
                    
                    // Division: multiply by reciprocal
                    const resultNum = num1 * denom2;
                    const resultDenom = denom1 * num2;
                    
                    const divisor = gcd(resultNum, resultDenom);
                    const finalNum = resultNum / divisor;
                    const finalDenom = resultDenom / divisor;
                    
                    ws.push({ 
                        q: `${num1}/${denom1} √∑ ${num2}/${denom2} = ? (answer as fraction)`, 
                        a: `${finalNum}/${finalDenom}` 
                    });
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        function generateDecimalsWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-15: Decimal addition (progressively harder)
            for (let w = 1; w <= 15; w++) {
                const ws = [];
                const decimalPlaces = w < 6 ? 1 : 2;
                const maxVal = 100 + w * 20;
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.pow(10, decimalPlaces);
                    const num1 = Math.floor(Math.random() * maxVal) / divisor;
                    const num2 = Math.floor(Math.random() * maxVal) / divisor;
                    const result = (num1 + num2).toFixed(decimalPlaces);
                    ws.push({ q: `${num1.toFixed(decimalPlaces)} + ${num2.toFixed(decimalPlaces)} = ?`, a: result });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 16-25: Decimal subtraction
            for (let w = 16; w <= 25; w++) {
                const ws = [];
                const decimalPlaces = w < 21 ? 1 : 2;
                const maxVal = 100 + (w - 15) * 25;
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.pow(10, decimalPlaces);
                    const num1 = Math.floor(Math.random() * maxVal + maxVal/2) / divisor;
                    const num2 = Math.floor(Math.random() * maxVal) / divisor;
                    if (num1 > num2) {
                        const result = (num1 - num2).toFixed(decimalPlaces);
                        ws.push({ q: `${num1.toFixed(decimalPlaces)} - ${num2.toFixed(decimalPlaces)} = ?`, a: result });
                    } else {
                        i--;
                    }
                }
                worksheets.push(ws);
            }
            
            // Worksheets 26-35: Decimal multiplication
            for (let w = 26; w <= 35; w++) {
                const ws = [];
                const difficulty = Math.floor((w - 26) / 3);
                for (let i = 0; i < 10; i++) {
                    const maxNum = 10 + difficulty * 20;
                    const num1 = (Math.floor(Math.random() * maxNum) + 1) / 10;
                    const num2 = (Math.floor(Math.random() * maxNum) + 1) / 10;
                    const result = (num1 * num2).toFixed(2);
                    ws.push({ q: `${num1.toFixed(1)} √ó ${num2.toFixed(1)} = ?`, a: result });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 36-45: Fraction to decimal conversion (progressively harder)
            for (let w = 36; w <= 45; w++) {
                const ws = [];
                const conversions = [
                    { frac: '1/2', dec: '0.5' }, { frac: '1/4', dec: '0.25' }, { frac: '3/4', dec: '0.75' },
                    { frac: '1/5', dec: '0.2' }, { frac: '2/5', dec: '0.4' }, { frac: '3/5', dec: '0.6' },
                    { frac: '4/5', dec: '0.8' }, { frac: '1/8', dec: '0.125' }, { frac: '3/8', dec: '0.375' },
                    { frac: '5/8', dec: '0.625' }, { frac: '7/8', dec: '0.875' }, { frac: '1/10', dec: '0.1' },
                    { frac: '3/10', dec: '0.3' }, { frac: '7/10', dec: '0.7' }, { frac: '9/10', dec: '0.9' },
                    { frac: '1/3', dec: '0.33' }, { frac: '2/3', dec: '0.67' }, { frac: '1/6', dec: '0.17' },
                    { frac: '5/6', dec: '0.83' }, { frac: '1/20', dec: '0.05' }
                ];
                
                // Shuffle and select 10
                const shuffled = conversions.sort(() => Math.random() - 0.5).slice(0, 10);
                for (let i = 0; i < 10; i++) {
                    const conv = shuffled[i];
                    ws.push({ q: `Convert to decimal: ${conv.frac} = ?`, a: conv.dec });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 46-50: Mixed operations (challenge)
            for (let w = 46; w <= 50; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const opType = Math.floor(Math.random() * 3);
                    if (opType === 0) {
                        // Addition
                        const num1 = (Math.floor(Math.random() * 500) + 100) / 100;
                        const num2 = (Math.floor(Math.random() * 500) + 100) / 100;
                        const result = (num1 + num2).toFixed(2);
                        ws.push({ q: `${num1.toFixed(2)} + ${num2.toFixed(2)} = ?`, a: result });
                    } else if (opType === 1) {
                        // Subtraction
                        const num1 = (Math.floor(Math.random() * 800) + 200) / 100;
                        const num2 = (Math.floor(Math.random() * 500) + 50) / 100;
                        const result = (num1 - num2).toFixed(2);
                        ws.push({ q: `${num1.toFixed(2)} - ${num2.toFixed(2)} = ?`, a: result });
                    } else {
                        // Multiplication
                        const num1 = (Math.floor(Math.random() * 120) + 10) / 10;
                        const num2 = (Math.floor(Math.random() * 120) + 10) / 10;
                        const result = (num1 * num2).toFixed(2);
                        ws.push({ q: `${num1.toFixed(1)} √ó ${num2.toFixed(1)} = ?`, a: result });
                    }
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        const readingContent = {
            'C': [
                {
                    title: 'The Water Cycle',
                    passage: `Water on Earth is constantly moving through a process called the water cycle. This cycle has been happening for billions of years and is essential for all life on our planet.

The water cycle begins with evaporation. When the Sun heats up water in rivers, lakes, and oceans, some of it turns into water vapor and rises into the air. Plants also release water vapor through a process called transpiration.

As the water vapor rises higher into the atmosphere, it cools down and condenses into tiny water droplets, forming clouds. This process is called condensation. When the droplets become heavy enough, they fall back to Earth as precipitation‚Äîrain, snow, sleet, or hail.

When precipitation falls on land, some of it flows into streams and rivers, eventually reaching the ocean. This is called runoff. Some water also seeps into the ground, becoming groundwater that plants and trees can use. The cycle then begins again with evaporation.`,
                    questions: [
                        { type: 'multiple', question: 'What causes water to evaporate?', options: ['Wind', 'The Sun', 'Clouds', 'Rain'], answer: 'The Sun' },
                        { type: 'multiple', question: 'What is the process of water vapor turning into clouds called?', options: ['Evaporation', 'Precipitation', 'Condensation', 'Transpiration'], answer: 'Condensation' },
                        { type: 'multiple', question: 'Which of these is NOT a form of precipitation?', options: ['Rain', 'Snow', 'Fog', 'Hail'], answer: 'Fog' },
                        { type: 'input', question: 'What is water that seeps into the ground called? (one word)', answer: 'groundwater' },
                        { type: 'multiple', question: 'What process do plants use to release water vapor?', options: ['Evaporation', 'Condensation', 'Transpiration', 'Precipitation'], answer: 'Transpiration' },
                    ]
                },
                {
                    title: 'Benjamin Franklin',
                    passage: `Benjamin Franklin was one of the most remarkable people in American history. Born in 1706 in Boston, he became famous as an inventor, writer, scientist, and statesman.

As a young man, Franklin worked as a printer and started his own newspaper. He became known for his witty sayings like "Early to bed and early to rise makes a man healthy, wealthy, and wise." He published these sayings in a book called Poor Richard's Almanack.

Franklin was also a brilliant inventor. He invented the lightning rod, which protects buildings from lightning strikes. He also created bifocal glasses, which help people see both near and far. He never patented his inventions because he believed they should benefit everyone.

In his later years, Franklin helped write the Declaration of Independence and the United States Constitution. He also served as an ambassador to France, helping to secure French support during the American Revolution. Franklin died in 1790 at the age of 84, leaving behind a legacy of innovation and service.`,
                    questions: [
                        { type: 'multiple', question: 'What was Benjamin Franklin\'s first job?', options: ['Inventor', 'Printer', 'Politician', 'Teacher'], answer: 'Printer' },
                        { type: 'multiple', question: 'What book did Franklin publish with witty sayings?', options: ['The Constitution', 'Poor Richard\'s Almanack', 'The Declaration', 'Boston Times'], answer: 'Poor Richard\'s Almanack' },
                        { type: 'multiple', question: 'What protects buildings from lightning?', options: ['Bifocals', 'Lightning rod', 'Newspaper', 'Almanack'], answer: 'Lightning rod' },
                        { type: 'multiple', question: 'Why didn\'t Franklin patent his inventions?', options: ['He forgot', 'He was too busy', 'He wanted everyone to benefit', 'They weren\'t important'], answer: 'He wanted everyone to benefit' },
                        { type: 'input', question: 'What country did Franklin serve as ambassador to? (one word)', answer: 'France' },
                    ]
                }
            ],
            'D': [
                {
                    title: 'Photosynthesis: How Plants Make Food',
                    passage: `Have you ever wondered how plants make their own food? Unlike animals, plants don't need to eat other organisms to survive. Instead, they create their own food through a remarkable process called photosynthesis.

Photosynthesis occurs mainly in the leaves of plants. Leaves contain millions of tiny structures called chloroplasts, which give plants their green color. Inside chloroplasts is a pigment called chlorophyll that captures energy from sunlight.

The process begins when plants absorb water through their roots and carbon dioxide from the air through tiny pores called stomata. Using the energy captured by chlorophyll, plants combine water and carbon dioxide to produce glucose (a type of sugar) and oxygen.

The glucose produced provides energy for the plant to grow and carry out life processes. The oxygen is released into the air as a waste product‚Äîwhich is fortunate for us because we need oxygen to breathe! In fact, plants produce most of the oxygen in Earth's atmosphere.

Photosynthesis is essential for life on Earth. It forms the foundation of most food chains, as plants are eaten by herbivores, which are in turn eaten by carnivores. Without photosynthesis, life as we know it could not exist.`,
                    questions: [
                        { type: 'multiple', question: 'Where does photosynthesis mainly occur in plants?', options: ['Roots', 'Stems', 'Leaves', 'Flowers'], answer: 'Leaves' },
                        { type: 'multiple', question: 'What gives plants their green color?', options: ['Glucose', 'Oxygen', 'Chlorophyll', 'Stomata'], answer: 'Chlorophyll' },
                        { type: 'input', question: 'What are the tiny pores that absorb carbon dioxide called? (one word)', answer: 'stomata' },
                        { type: 'multiple', question: 'What type of sugar do plants produce?', options: ['Fructose', 'Glucose', 'Sucrose', 'Lactose'], answer: 'Glucose' },
                        { type: 'multiple', question: 'What "waste product" do plants release that we need?', options: ['Carbon dioxide', 'Water', 'Glucose', 'Oxygen'], answer: 'Oxygen' },
                    ]
                },
                {
                    title: 'The Journey of the Mayflower',
                    passage: `In September 1620, a small ship called the Mayflower set sail from Plymouth, England, carrying 102 passengers. These passengers, known as Pilgrims, were seeking religious freedom and a new life in America. They faced a dangerous journey across the Atlantic Ocean that would change the course of history.

The voyage was extremely difficult. The ship was only about 100 feet long‚Äîroughly the size of a modern volleyball court‚Äîand was packed with passengers, crew, supplies, and even farm animals. Storms battered the vessel, and one main beam cracked during the journey. The passengers were seasick and frightened, but they pressed on.

After 66 days at sea, the Mayflower finally reached land in November 1620. However, they had been blown off course and arrived at Cape Cod in present-day Massachusetts instead of their intended destination near the Hudson River. The Pilgrims decided to settle there and established Plymouth Colony.

Before leaving the ship, the male passengers signed an agreement called the Mayflower Compact. This document established a government based on majority rule and is considered one of the first examples of self-government in America. It stated that they would create "just and equal laws" for the good of the colony.

The first winter was brutal. Nearly half of the Pilgrims died from disease and harsh conditions. However, with help from the Wampanoag people, particularly a man named Squanto, the survivors learned to farm in their new land. In autumn 1621, they celebrated their first successful harvest with a feast of thanksgiving‚Äîan event that became the foundation for the American holiday of Thanksgiving.`,
                    questions: [
                        { type: 'input', question: 'How many passengers were on the Mayflower? (number only)', answer: '102' },
                        { type: 'multiple', question: 'How long did the voyage take?', options: ['40 days', '50 days', '66 days', '80 days'], answer: '66 days' },
                        { type: 'multiple', question: 'Where did the Pilgrims originally intend to land?', options: ['Cape Cod', 'Plymouth', 'Near the Hudson River', 'Boston'], answer: 'Near the Hudson River' },
                        { type: 'input', question: 'What was the name of the document signed before leaving the ship? (two words, capitalized)', answer: 'Mayflower Compact' },
                        { type: 'multiple', question: 'About how many Pilgrims survived the first winter?', options: ['All of them', 'About half', 'Only a few', 'None of them'], answer: 'About half' },
                    ]
                }
            ],
            'E': [
                {
                    title: 'The Scientific Method',
                    passage: `Science is not just a collection of facts‚Äîit's a way of thinking and asking questions about the world. Scientists use a process called the scientific method to investigate questions and solve problems systematically.

The scientific method begins with observation. Scientists notice something interesting or puzzling in the natural world. This leads to asking a question: "Why does this happen?" or "How does this work?" A good scientific question is specific and testable.

Next comes forming a hypothesis, which is an educated guess or prediction about what might happen. A hypothesis must be testable through experiments. For example, if you notice that plants near a window grow faster, you might hypothesize that "plants grow faster when they receive more sunlight."

The experiment is where scientists test their hypothesis. They design a controlled experiment where they change only one variable (the independent variable) while keeping everything else the same. They measure the results (the dependent variable) and record their observations carefully. It's crucial to repeat experiments multiple times to ensure results are consistent.

After collecting data, scientists analyze their results to see if they support or contradict the hypothesis. If the data supports the hypothesis, it becomes stronger. If not, scientists revise their hypothesis and test again. This process of testing, analyzing, and refining is what makes science self-correcting.

Finally, scientists share their findings with others through publications and presentations. Other researchers can then repeat the experiments to verify the results. This peer review process ensures that scientific knowledge is reliable and trustworthy.

The beauty of the scientific method is that it's not just for professional scientists. Anyone can use it to investigate questions, from testing which paper towel brand is most absorbent to figuring out the best study techniques. Science is a tool we can all use to understand our world better.`,
                    questions: [
                        { type: 'multiple', question: 'What is the first step of the scientific method?', options: ['Hypothesis', 'Experiment', 'Observation', 'Analysis'], answer: 'Observation' },
                        { type: 'input', question: 'What do we call an educated guess that can be tested? (one word)', answer: 'hypothesis' },
                        { type: 'multiple', question: 'In an experiment, what is the variable that the scientist changes?', options: ['Dependent variable', 'Independent variable', 'Constant', 'Control'], answer: 'Independent variable' },
                        { type: 'multiple', question: 'Why is it important to repeat experiments?', options: ['To save time', 'To ensure results are consistent', 'To prove you are right', 'To publish more papers'], answer: 'To ensure results are consistent' },
                        { type: 'multiple', question: 'What makes science self-correcting?', options: ['Expensive equipment', 'The process of testing and refining', 'Smart scientists', 'Computer models'], answer: 'The process of testing and refining' },
                    ]
                },
                {
                    title: 'The American Civil War',
                    passage: `The American Civil War (1861-1865) was the deadliest conflict in American history, claiming over 600,000 lives. This war between the Northern states (the Union) and the Southern states (the Confederacy) fundamentally transformed the nation and ended the institution of slavery.

The roots of the Civil War lay in deep disagreements between North and South. The Northern states had developed an industrial economy based on manufacturing and trade, while the Southern states relied heavily on agriculture, particularly cotton production using enslaved labor. As the nation expanded westward, fierce debates erupted over whether new states would allow slavery.

The election of Abraham Lincoln in 1860 proved to be the breaking point. Lincoln opposed the expansion of slavery into new territories, though he initially didn't call for abolishing it where it already existed. Seven Southern states seceded from the Union even before Lincoln took office, forming the Confederate States of America. Four more states joined after fighting began.

The war started on April 12, 1861, when Confederate forces fired on Fort Sumter in South Carolina. What many expected to be a short conflict turned into four years of brutal warfare. The North had significant advantages in population, industrial capacity, and railroad networks, but the South had superior military leadership early in the war and was fighting on familiar territory.

A turning point came with the Battle of Gettysburg in July 1863, where Union forces halted the Confederacy's invasion of the North. Around the same time, Union forces gained control of the Mississippi River, splitting the Confederacy in two. President Lincoln issued the Emancipation Proclamation in 1863, declaring that all enslaved people in Confederate territory were free. This transformed the war from a fight to preserve the Union into a fight for human freedom.

The war ended in April 1865 when Confederate General Robert E. Lee surrendered to Union General Ulysses S. Grant at Appomattox Court House, Virginia. Just days later, President Lincoln was assassinated by John Wilkes Booth, a Southern sympathizer.

The Civil War's aftermath brought profound changes. The 13th Amendment abolished slavery throughout the United States. The 14th Amendment granted citizenship to formerly enslaved people, and the 15th Amendment protected voting rights regardless of race. However, the period of Reconstruction that followed was marked by continued conflict over civil rights‚Äîstruggles that would continue for another century.`,
                    questions: [
                        { type: 'input', question: 'Approximately how many lives were lost in the Civil War? (number only)', answer: '600000' },
                        { type: 'multiple', question: 'What was the main economic difference between North and South?', options: ['North was agricultural, South was industrial', 'North was industrial, South was agricultural', 'Both were industrial', 'Both were agricultural'], answer: 'North was industrial, South was agricultural' },
                        { type: 'input', question: 'In what year did the Civil War begin? (number only)', answer: '1861' },
                        { type: 'multiple', question: 'What battle is considered a turning point of the war?', options: ['Fort Sumter', 'Gettysburg', 'Appomattox', 'Bull Run'], answer: 'Gettysburg' },
                        { type: 'multiple', question: 'Which amendment abolished slavery?', options: ['13th Amendment', '14th Amendment', '15th Amendment', 'Emancipation Proclamation'], answer: '13th Amendment' },
                    ]
                }
            ]
        };

        function selectGrade(grade) {
            currentGrade = grade;
            document.querySelectorAll('.grade-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.grade-btn').classList.add('active');
            document.getElementById('subjectSelector').classList.remove('hidden');
        }

        function selectSubject(subject) {
            currentSubject = subject;
            document.querySelectorAll('.subject-card').forEach(card => card.classList.remove('active'));
            event.target.closest('.subject-card').classList.add('active');
            
            setTimeout(() => {
                if (subject === 'math') {
                    showWorksheetSelector();
                } else {
                    generateReadingWorksheet();
                }
            }, 300);
        }

        function showWorksheetSelector() {
            document.getElementById('subjectSelector').classList.add('hidden');
            document.getElementById('worksheetSelector').classList.remove('hidden');
            
            const worksheetList = document.getElementById('worksheetList');
            worksheetList.innerHTML = '';
            
            const sublevels = Object.keys(mathWorksheets[currentGrade]);
            
            sublevels.forEach(sublevel => {
                const section = document.createElement('div');
                section.className = 'sublevel-section';
                
                const title = document.createElement('div');
                title.className = 'sublevel-title';
                title.textContent = sublevel;
                section.appendChild(title);
                
                const grid = document.createElement('div');
                grid.className = 'worksheet-grid';
                
                for (let i = 1; i <= 50; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'worksheet-btn';
                    btn.textContent = `#${i}`;
                    const wsKey = `${currentGrade}-${sublevel}-${i}`;
                    if (completedWorksheets[wsKey]) {
                        btn.classList.add('completed');
                        btn.textContent += ' ‚úì';
                    }
                    btn.onclick = () => selectWorksheet(sublevel, i);
                    grid.appendChild(btn);
                }
                
                section.appendChild(grid);
                worksheetList.appendChild(section);
            });
            
            document.getElementById('worksheetSelector').scrollIntoView({ behavior: 'smooth' });
        }

        function selectWorksheet(sublevel, worksheetNum) {
            currentSublevel = sublevel;
            currentWorksheetNum = worksheetNum;
            generateMathWorksheet();
        }

        function generateMathWorksheet() {
            checkedOnce = false;
            userAnswers = {};
            
            const worksheetArea = document.getElementById('worksheetArea');
            const questionsContainer = document.getElementById('questionsContainer');
            const worksheetTitle = document.getElementById('worksheetTitle');
            
            document.getElementById('worksheetSelector').classList.add('hidden');
            worksheetArea.classList.remove('hidden');
            
            questionsContainer.innerHTML = '';
            clearCanvas();
            
            worksheetTitle.textContent = `Level ${currentGrade} - ${currentSublevel} - Worksheet ${currentWorksheetNum}`;
            
            const worksheet = mathWorksheets[currentGrade][currentSublevel][currentWorksheetNum - 1];
            currentQuestions = worksheet.map(item => ({
                type: 'input',
                question: item.q,
                answer: item.a,
                category: currentSublevel
            }));
            
            renderMathQuestions();
            updateProgress();
            
            worksheetArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            initCanvas();
        }

        function generateReadingWorksheet() {
            checkedOnce = false;
            userAnswers = {};
            
            const worksheetArea = document.getElementById('worksheetArea');
            const questionsContainer = document.getElementById('questionsContainer');
            const worksheetTitle = document.getElementById('worksheetTitle');
            
            document.getElementById('subjectSelector').classList.add('hidden');
            worksheetArea.classList.remove('hidden');
            
            questionsContainer.innerHTML = '';
            clearCanvas();
            
            worksheetTitle.textContent = `Level ${currentGrade} Reading Comprehension`;
            const readingSet = readingContent[currentGrade][Math.floor(Math.random() * readingContent[currentGrade].length)];
            currentQuestions = readingSet.questions;
            renderReadingQuestions(readingSet);
            
            updateProgress();
            worksheetArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            initCanvas();
        }

        function renderMathQuestions() {
            const container = document.getElementById('questionsContainer');
            
            currentQuestions.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-number">Question ${index + 1} ${q.category ? `<span style="opacity: 0.7; font-size: 0.85em;">‚Ä¢ ${q.category}</span>` : ''}</div>
                    <div class="question-text">${q.question}</div>
                    <input type="text" class="answer-input" id="answer-${index}" 
                         placeholder="Type your answer here..."
                         onchange="saveAnswer(${index}, this.value)">
                    <div id="feedback-${index}"></div>
                `;
                container.appendChild(questionCard);
            });
        }

        function renderReadingQuestions(readingSet) {
            const container = document.getElementById('questionsContainer');
            
            const passageDiv = document.createElement('div');
            passageDiv.className = 'reading-passage';
            passageDiv.innerHTML = `
                <h3>${readingSet.title}</h3>
                ${readingSet.passage.split('\n\n').map(p => `<p>${p}</p>`).join('')}
            `;
            container.appendChild(passageDiv);
            
            currentQuestions.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-number">Question ${index + 1}</div>
                    <div class="question-text">${q.question}</div>
                    ${q.type === 'input' 
                        ? `<input type="text" class="answer-input" id="answer-${index}" 
                             placeholder="Type your answer here..."
                             onchange="saveAnswer(${index}, this.value)">`
                        : `<div class="options-container">
                             ${q.options.map((opt, i) => 
                                `<button class="option-btn" onclick="selectOption(${index}, '${opt}', this)">
                                    ${opt}
                                 </button>`
                             ).join('')}
                           </div>`
                    }
                    <div id="feedback-${index}"></div>
                `;
                container.appendChild(questionCard);
            });
        }

        function saveAnswer(questionIndex, answer) {
            userAnswers[questionIndex] = answer.trim();
        }

        function selectOption(questionIndex, option, button) {
            const container = button.parentElement;
            container.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
            userAnswers[questionIndex] = option;
        }

        function checkAnswers() {
            let correctCount = 0;
            
            currentQuestions.forEach((q, index) => {
                const userAnswer = userAnswers[index];
                const feedbackDiv = document.getElementById(`feedback-${index}`);
                const inputElement = document.getElementById(`answer-${index}`);
                
                if (!userAnswer) {
                    feedbackDiv.innerHTML = '<div class="feedback-message incorrect">‚ö†Ô∏è Please answer this question!</div>';
                    return;
                }
                
                const isCorrect = checkAnswer(userAnswer, q.answer);
                
                if (isCorrect) {
                    correctCount++;
                    feedbackDiv.innerHTML = '<div class="feedback-message correct">‚ú® Excellent! That\'s correct!</div>';
                    if (inputElement) {
                        inputElement.classList.add('correct');
                        inputElement.classList.remove('incorrect');
                    }
                    highlightCorrectOption(index, q.answer);
                } else {
                    feedbackDiv.innerHTML = `<div class="feedback-message incorrect">üí° Not quite. The answer is: ${q.answer}</div>`;
                    if (inputElement) {
                        inputElement.classList.add('incorrect');
                        inputElement.classList.remove('correct');
                    }
                    highlightIncorrectOption(index, userAnswer, q.answer);
                }
            });
            
            updateProgress(correctCount);
            
            // Record the worksheet completion
            if (currentSubject === 'math' && currentSublevel && currentWorksheetNum) {
                recordWorksheet(currentGrade, 'math', currentSublevel, currentWorksheetNum, correctCount, currentQuestions.length);
            } else if (currentSubject === 'reading') {
                recordWorksheet(currentGrade, 'reading', 'Reading', 1, correctCount, currentQuestions.length);
            }
            
            if (correctCount === currentQuestions.length && currentSubject === 'math') {
                const wsKey = `${currentGrade}-${currentSublevel}-${currentWorksheetNum}`;
                completedWorksheets[wsKey] = true;
            }
            
            if (correctCount === currentQuestions.length) {
                setTimeout(() => {
                    showCompletionScreen(correctCount);
                }, 1500);
            }
            
            checkedOnce = true;
        }

        function checkAnswer(userAnswer, correctAnswer) {
            const normalizeAnswer = (ans) => {
                return ans.toString().toLowerCase().replace(/[^a-z0-9./\s]/g, '').trim();
            };
            return normalizeAnswer(userAnswer) === normalizeAnswer(correctAnswer);
        }

        function highlightCorrectOption(questionIndex, correctAnswer) {
            const container = document.getElementById(`feedback-${questionIndex}`).parentElement;
            const buttons = container.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                if (btn.textContent.trim() === correctAnswer) {
                    btn.classList.add('correct');
                }
            });
        }

        function highlightIncorrectOption(questionIndex, userAnswer, correctAnswer) {
            const container = document.getElementById(`feedback-${questionIndex}`).parentElement;
            const buttons = container.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                const btnText = btn.textContent.trim();
                if (btnText === userAnswer) {
                    btn.classList.add('incorrect');
                }
                if (btnText === correctAnswer) {
                    btn.classList.add('correct');
                }
            });
        }

        function updateProgress(correct = 0) {
            const answered = Object.keys(userAnswers).length;
            const total = currentQuestions.length;
            
            document.getElementById('progressText').textContent = `${answered}/${total}`;
            document.getElementById('progressFill').style.width = `${(answered / total) * 100}%`;
            
            if (correct > 0) {
                const stars = '‚≠ê'.repeat(Math.min(correct, 10));
                document.getElementById('starsEarned').textContent = stars;
            }
        }

        function showCompletionScreen(score) {
            const container = document.getElementById('questionsContainer');
            const total = currentQuestions.length;
            const percentage = (score / total) * 100;
            
            let message = '';
            let emoji = '';
            
            if (percentage === 100) {
                message = 'Perfect Score!';
                emoji = 'üèÜ';
            } else if (percentage >= 80) {
                message = 'Great Job!';
                emoji = 'üåü';
            } else if (percentage >= 60) {
                message = 'Good Work!';
                emoji = 'üëç';
            } else {
                message = 'Keep Practicing!';
                emoji = 'üí™';
            }
            
            container.innerHTML = `
                <div class="completion-screen">
                    <h2>${message}</h2>
                    <div class="star-animation">${emoji}</div>
                    <div class="score-display">${score}/${total}</div>
                    <p style="font-size: 1.3em; color: var(--text-light); margin: 20px 0;">
                        You got ${percentage.toFixed(0)}% correct!
                    </p>
                </div>
            `;
        }

        function backToWorksheetList() {
            document.getElementById('worksheetArea').classList.add('hidden');
            if (currentSubject === 'math') {
                showWorksheetSelector();
            } else {
                document.getElementById('subjectSelector').classList.remove('hidden');
            }
            document.getElementById('starsEarned').textContent = '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function backToMenu() {
            document.getElementById('worksheetArea').classList.add('hidden');
            document.getElementById('worksheetSelector').classList.add('hidden');
            document.getElementById('subjectSelector').classList.remove('hidden');
            document.getElementById('starsEarned').textContent = '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Study Records Functions
        function showStudyRecords() {
            document.querySelector('.student-selector').classList.add('hidden');
            document.getElementById('subjectSelector').classList.add('hidden');
            document.getElementById('worksheetSelector').classList.add('hidden');
            document.getElementById('worksheetArea').classList.add('hidden');
            document.getElementById('studyRecords').classList.remove('hidden');
            
            currentCalendarDate = new Date();
            renderCalendar();
            renderStats();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function closeStudyRecords() {
            document.getElementById('studyRecords').classList.add('hidden');
            document.querySelector('.student-selector').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function switchRecordsTab(subject) {
            currentRecordsTab = subject;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderCalendar();
            renderStats();
        }

        function changeMonth(delta) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            renderCalendar();
        }

        function renderCalendar() {
            const monthYear = document.getElementById('monthYear');
            const calendarGrid = document.getElementById('calendarGrid');
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            monthYear.textContent = `${monthNames[month]} ${year}`;
            
            // Clear calendar
            calendarGrid.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            // Add previous month's days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day other-month';
                dayDiv.innerHTML = `<div class="day-number">${day}</div>`;
                calendarGrid.appendChild(dayDiv);
            }
            
            // Add current month's days
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                
                if (dateStr === todayStr) {
                    dayDiv.classList.add('today');
                }
                
                const dayData = studyRecords[currentRecordsTab][dateStr];
                
                if (dayData && dayData.length > 0) {
                    dayDiv.classList.add('has-progress');
                    
                    const totalSheets = dayData.length;
                    const avgPercentage = Math.round(
                        dayData.reduce((sum, ws) => sum + ws.percentage, 0) / totalSheets
                    );
                    
                    dayDiv.innerHTML = `
                        <div class="day-number">${day}</div>
                        <div class="day-stats">
                            <div class="sheets">${totalSheets} sheet${totalSheets > 1 ? 's' : ''}</div>
                            <div class="percentage">${avgPercentage}%</div>
                        </div>
                    `;
                    
                    dayDiv.onclick = () => showDayDetail(dateStr, dayData);
                } else {
                    dayDiv.innerHTML = `<div class="day-number">${day}</div>`;
                }
                
                calendarGrid.appendChild(dayDiv);
            }
            
            // Add next month's days to fill grid
            const totalCells = calendarGrid.children.length - 7; // subtract headers
            const remainingCells = (Math.ceil((firstDay + daysInMonth) / 7) * 7) - (firstDay + daysInMonth);
            
            for (let day = 1; day <= remainingCells; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day other-month';
                dayDiv.innerHTML = `<div class="day-number">${day}</div>`;
                calendarGrid.appendChild(dayDiv);
            }
        }

        function renderStats() {
            const statsSummary = document.getElementById('statsSummary');
            const records = studyRecords[currentRecordsTab];
            
            let totalSheets = 0;
            let totalCorrect = 0;
            let totalQuestions = 0;
            let perfectDays = 0;
            
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            Object.keys(records).forEach(date => {
                const dateObj = new Date(date);
                if (dateObj >= thirtyDaysAgo) {
                    const dayData = records[date];
                    dayData.forEach(ws => {
                        totalSheets++;
                        totalCorrect += ws.score;
                        totalQuestions += ws.total;
                    });
                    
                    const dayAvg = dayData.reduce((sum, ws) => sum + ws.percentage, 0) / dayData.length;
                    if (dayAvg === 100) perfectDays++;
                }
            });
            
            const overallPercentage = totalQuestions > 0 
                ? Math.round((totalCorrect / totalQuestions) * 100) 
                : 0;
            
            statsSummary.innerHTML = `
                <div class="stat-card">
                    <h3>Worksheets (30 days)</h3>
                    <div class="stat-value">${totalSheets}</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--primary) 0%, var(--orange) 100%);">
                    <h3>Average Score</h3>
                    <div class="stat-value">${overallPercentage}%</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--success) 0%, var(--purple) 100%);">
                    <h3>Perfect Days</h3>
                    <div class="stat-value">${perfectDays}</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--accent) 0%, var(--orange) 100%); color: var(--text-dark);">
                    <h3>Current Streak</h3>
                    <div class="stat-value">${calculateStreak()} üî•</div>
                </div>
            `;
        }

        function calculateStreak() {
            const records = studyRecords[currentRecordsTab];
            let streak = 0;
            const today = new Date();
            
            for (let i = 0; i < 365; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(checkDate.getDate() - i);
                const dateStr = checkDate.toISOString().split('T')[0];
                
                if (records[dateStr] && records[dateStr].length > 0) {
                    streak++;
                } else if (i > 0) {
                    break;
                }
            }
            
            return streak;
        }

        function showDayDetail(dateStr, dayData) {
            const modal = document.createElement('div');
            modal.className = 'day-detail-modal';
            modal.onclick = (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
            
            const date = new Date(dateStr);
            const formattedDate = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const worksheetItems = dayData.map(ws => {
                const scoreClass = ws.percentage === 100 ? 'perfect' : 
                                 ws.percentage >= 80 ? 'good' : 'needs-work';
                
                const worksheetName = ws.sublevel 
                    ? `${ws.grade} - ${ws.sublevel} - Worksheet ${ws.worksheet}`
                    : `${ws.grade} - ${ws.sublevel}`;
                
                return `
                    <div class="worksheet-item">
                        <div class="name">${worksheetName}</div>
                        <div class="score ${scoreClass}">${ws.score}/${ws.total} (${ws.percentage}%)</div>
                    </div>
                `;
            }).join('');
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>${formattedDate}</h3>
                        <button class="close-modal" onclick="this.closest('.day-detail-modal').remove()">√ó</button>
                    </div>
                    <div class="worksheet-list">
                        ${worksheetItems}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            loadStudyRecords();
            if (document.getElementById('scratchCanvas')) {
                initCanvas();
            }
        });
    </script>
</body>
</html>