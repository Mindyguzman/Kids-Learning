<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn & Grow - Math & Reading Practice (Levels C & D)</title>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --accent: #FFE66D;
            --success: #95E1D3;
            --purple: #A8E6CF;
            --orange: #FFB347;
            --bg-main: #FFF9F0;
            --text-dark: #2C3E50;
            --text-light: #7F8C8D;
            --shadow: 0 8px 24px rgba(0,0,0,0.12);
            --shadow-sm: 0 4px 12px rgba(0,0,0,0.08);
        }

        body {
            font-family: 'Baloo 2', cursive;
            background: linear-gradient(135deg, #FFF9F0 0%, #FFE8D6 100%);
            min-height: 100vh;
            color: var(--text-dark);
            padding: 20px;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: 3em;
            color: var(--primary);
            text-shadow: 3px 3px 0 var(--accent);
            margin-bottom: 10px;
            font-weight: 800;
        }

        .header p {
            font-size: 1.2em;
            color: var(--text-light);
        }

        .student-selector {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .student-selector h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .grade-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .grade-btn {
            flex: 1;
            min-width: 200px;
            padding: 30px;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--purple) 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.3em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            font-family: 'Baloo 2', cursive;
        }

        .grade-btn:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .grade-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--orange) 100%);
            transform: scale(1.05);
        }

        .subject-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease-out 0.4s both;
        }

        .subject-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            border: 3px solid transparent;
        }

        .subject-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow);
        }

        .subject-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, #FFF 0%, #FFE8D6 100%);
        }

        .subject-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .subject-card h3 {
            font-size: 1.5em;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .subject-card p {
            color: var(--text-light);
        }

        .worksheet-selector {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease-out 0.6s both;
        }

        .worksheet-selector h3 {
            color: var(--secondary);
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .sublevel-section {
            margin-bottom: 25px;
        }

        .sublevel-title {
            font-size: 1.2em;
            color: var(--text-dark);
            margin-bottom: 15px;
            font-weight: 700;
            padding: 15px;
            background: linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%);
            border-radius: 10px;
        }

        .worksheet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }

        .worksheet-btn {
            padding: 15px;
            background: linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%);
            border: 3px solid #DEE2E6;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Baloo 2', cursive;
            color: var(--text-dark);
        }

        .worksheet-btn:hover {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--purple) 100%);
            color: white;
            border-color: var(--secondary);
            transform: scale(1.05);
        }

        .worksheet-btn.completed {
            background: linear-gradient(135deg, var(--success) 0%, var(--purple) 100%);
            color: white;
            border-color: var(--success);
        }

        .worksheet-area {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease-out 0.6s both;
        }

        .worksheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .worksheet-title {
            font-size: 2em;
            color: var(--primary);
            font-weight: 700;
        }

        .progress-container {
            flex: 1;
            min-width: 200px;
        }

        .progress-label {
            font-size: 0.9em;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 20px;
            background: #E8E8E8;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary) 0%, var(--success) 100%);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .stars-earned {
            text-align: center;
            font-size: 2em;
            margin-top: 10px;
        }

        .drawing-tools {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .drawing-tools h4 {
            margin: 0;
            color: var(--text-dark);
            font-size: 1.2em;
        }

        .tool-btn {
            padding: 10px 20px;
            border: 2px solid #DEE2E6;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-family: 'Baloo 2', cursive;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tool-btn:hover {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .tool-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .color-picker {
            width: 50px;
            height: 40px;
            border: 2px solid #DEE2E6;
            border-radius: 8px;
            cursor: pointer;
        }

        .canvas-container {
            position: relative;
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }

        #scratchCanvas {
            border: 2px dashed #DEE2E6;
            border-radius: 10px;
            cursor: crosshair;
            touch-action: none;
            background: #FFFEF9;
            width: 100%;
            max-width: 100%;
        }

        .question-card {
            background: linear-gradient(135deg, #F8F9FA 0%, #FFFFFF 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            border-left: 5px solid var(--secondary);
            transition: all 0.3s ease;
        }

        .question-card:hover {
            box-shadow: var(--shadow-sm);
            transform: translateX(5px);
        }

        .question-number {
            display: inline-block;
            background: var(--accent);
            color: var(--text-dark);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .question-text {
            font-size: 1.3em;
            color: var(--text-dark);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #E8E8E8;
            border-radius: 10px;
            font-family: 'Comic Neue', cursive;
            transition: all 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        .answer-input.correct {
            border-color: var(--success);
            background: #F0FFF4;
        }

        .answer-input.incorrect {
            border-color: var(--primary);
            background: #FFF5F5;
        }

        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .option-btn {
            padding: 20px;
            background: white;
            border: 3px solid #E8E8E8;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Baloo 2', cursive;
            font-weight: 600;
        }

        .option-btn:hover {
            border-color: var(--secondary);
            transform: scale(1.05);
        }

        .option-btn.selected {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .option-btn.correct {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .option-btn.incorrect {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 18px 40px;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Baloo 2', cursive;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--purple) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: white;
            color: var(--text-dark);
            border: 3px solid var(--secondary);
        }

        .btn-secondary:hover {
            background: var(--secondary);
            color: white;
        }

        .feedback-message {
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            font-size: 1.1em;
            font-weight: 600;
            text-align: center;
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .feedback-message.correct {
            background: var(--success);
            color: white;
        }

        .feedback-message.incorrect {
            background: #FFE8E8;
            color: var(--primary);
        }

        .completion-screen {
            text-align: center;
            padding: 60px 20px;
        }

        .completion-screen h2 {
            font-size: 3em;
            color: var(--primary);
            margin-bottom: 20px;
            animation: bounceIn 0.8s ease;
        }

        .score-display {
            font-size: 4em;
            color: var(--secondary);
            margin: 30px 0;
            font-weight: 800;
            animation: bounceIn 1s ease 0.2s both;
        }

        .star-animation {
            font-size: 6em;
            margin: 20px 0;
            animation: starPulse 1.5s ease infinite;
        }

        @keyframes starPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }

        .reading-passage {
            background: #FFFEF9;
            border: 3px solid var(--accent);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            line-height: 2;
            font-size: 1.15em;
            font-family: 'Comic Neue', cursive;
        }

        .reading-passage h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .reading-passage p {
            margin-bottom: 20px;
            color: var(--text-dark);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .worksheet-header {
                flex-direction: column;
            }
            
            .grade-buttons {
                flex-direction: column;
            }
            
            .subject-selector {
                grid-template-columns: 1fr;
            }

            .worksheet-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }

            .drawing-tools {
                flex-direction: column;
                align-items: stretch;
            }

            #scratchCanvas {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>üìö Learn & Grow üåü</h1>
            <p>Level C (5th Grade) & Level D (6th Grade) - Practice makes perfect!</p>
        </div>

        <div class="student-selector">
            <h2>Select Your Level</h2>
            <div class="grade-buttons">
                <button class="grade-btn" onclick="selectGrade('C')">
                    üéØ Level C (5th Grade)<br>
                    <small style="font-size: 0.8em; opacity: 0.9;">Multiplication & Division</small>
                </button>
                <button class="grade-btn" onclick="selectGrade('D')">
                    üöÄ Level D (6th Grade)<br>
                    <small style="font-size: 0.8em; opacity: 0.9;">Long Division, Fractions & Decimals</small>
                </button>
            </div>
        </div>

        <div id="subjectSelector" class="subject-selector hidden">
            <div class="subject-card" onclick="selectSubject('math')">
                <div class="subject-icon">üî¢</div>
                <h3>Math Practice</h3>
                <p>Numbers, operations, and problem solving</p>
            </div>
            <div class="subject-card" onclick="selectSubject('reading')">
                <div class="subject-icon">üìñ</div>
                <h3>Reading Practice</h3>
                <p>Comprehension and vocabulary</p>
            </div>
        </div>

        <div id="worksheetSelector" class="worksheet-selector hidden">
            <h3>Select a Worksheet</h3>
            <div id="worksheetList"></div>
        </div>

        <div id="worksheetArea" class="worksheet-area hidden">
            <div class="worksheet-header">
                <div class="worksheet-title" id="worksheetTitle"></div>
                <div class="progress-container">
                    <div class="progress-label">Progress: <span id="progressText">0/10</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="stars-earned" id="starsEarned"></div>
                </div>
            </div>

            <div class="drawing-tools">
                <h4>‚úèÔ∏è Scratch Paper:</h4>
                <button class="tool-btn active" onclick="setDrawingTool('pen')" id="penBtn">Pen</button>
                <button class="tool-btn" onclick="setDrawingTool('eraser')" id="eraserBtn">Eraser</button>
                <input type="color" class="color-picker" id="colorPicker" value="#2C3E50" onchange="setDrawingColor(this.value)">
                <button class="tool-btn" onclick="clearCanvas()">Clear All</button>
                <label style="display: flex; align-items: center; gap: 10px;">
                    <span>Line Width:</span>
                    <input type="range" min="1" max="10" value="3" id="lineWidth" onchange="setLineWidth(this.value)" style="width: 100px;">
                </label>
            </div>

            <div class="canvas-container">
                <canvas id="scratchCanvas" width="800" height="400"></canvas>
            </div>

            <div id="questionsContainer"></div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="checkAnswers()">Check My Answers ‚úì</button>
                <button class="btn btn-secondary" onclick="backToWorksheetList()">Choose Another Worksheet üìã</button>
                <button class="btn btn-secondary" onclick="backToMenu()">Back to Menu üè†</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentGrade = null;
        let currentSubject = null;
        let currentSublevel = null;
        let currentWorksheetNum = null;
        let currentQuestions = [];
        let userAnswers = {};
        let checkedOnce = false;
        let completedWorksheets = {};

        // Drawing canvas variables
        let canvas, ctx;
        let isDrawing = false;
        let currentTool = 'pen';
        let currentColor = '#2C3E50';
        let lineWidth = 3;

        // Initialize canvas
        function initCanvas() {
            canvas = document.getElementById('scratchCanvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas size based on container
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth - 40;
            canvas.width = Math.min(800, containerWidth);
            canvas.height = 400;
            
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            ctx.lineWidth = lineWidth;
            ctx.strokeStyle = currentTool === 'eraser' ? '#FFFEF9' : currentColor;
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function setDrawingTool(tool) {
            currentTool = tool;
            document.getElementById('penBtn').classList.toggle('active', tool === 'pen');
            document.getElementById('eraserBtn').classList.toggle('active', tool === 'eraser');
        }

        function setDrawingColor(color) {
            currentColor = color;
        }

        function setLineWidth(width) {
            lineWidth = width;
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Comprehensive worksheet data - 10 worksheets per sublevel
        const mathWorksheets = {
            'C': {
                'Tables': generateTablesWorksheets(),
                'Multi-digit': generateMultiDigitWorksheets(),
                'Division': generateDivisionWorksheets()
            },
            'D': {
                'Long Division': generateLongDivisionWorksheets(),
                'Fractions': generateFractionsWorksheets(),
                'Multiplication & Decimals': generateMultiplicationDecimalsWorksheets()
            }
        };

        function generateTablesWorksheets() {
            const worksheets = [];
            
            // Worksheet 1: 2-4 tables
            worksheets.push([
                { q: '2 √ó 3 = ?', a: '6' },
                { q: '3 √ó 4 = ?', a: '12' },
                { q: '4 √ó 5 = ?', a: '20' },
                { q: '2 √ó 7 = ?', a: '14' },
                { q: '3 √ó 6 = ?', a: '18' },
                { q: '4 √ó 3 = ?', a: '12' },
                { q: '2 √ó 9 = ?', a: '18' },
                { q: '3 √ó 8 = ?', a: '24' },
                { q: '4 √ó 7 = ?', a: '28' },
                { q: '2 √ó 6 = ?', a: '12' }
            ]);
            
            // Worksheet 2: 5-6 tables
            worksheets.push([
                { q: '5 √ó 4 = ?', a: '20' },
                { q: '6 √ó 3 = ?', a: '18' },
                { q: '5 √ó 7 = ?', a: '35' },
                { q: '6 √ó 5 = ?', a: '30' },
                { q: '5 √ó 9 = ?', a: '45' },
                { q: '6 √ó 7 = ?', a: '42' },
                { q: '5 √ó 6 = ?', a: '30' },
                { q: '6 √ó 8 = ?', a: '48' },
                { q: '5 √ó 8 = ?', a: '40' },
                { q: '6 √ó 9 = ?', a: '54' }
            ]);
            
            // Worksheet 3: 7-8 tables
            worksheets.push([
                { q: '7 √ó 4 = ?', a: '28' },
                { q: '8 √ó 3 = ?', a: '24' },
                { q: '7 √ó 6 = ?', a: '42' },
                { q: '8 √ó 5 = ?', a: '40' },
                { q: '7 √ó 8 = ?', a: '56' },
                { q: '8 √ó 7 = ?', a: '56' },
                { q: '7 √ó 9 = ?', a: '63' },
                { q: '8 √ó 6 = ?', a: '48' },
                { q: '7 √ó 7 = ?', a: '49' },
                { q: '8 √ó 9 = ?', a: '72' }
            ]);
            
            // Worksheet 4: 9 tables
            worksheets.push([
                { q: '9 √ó 2 = ?', a: '18' },
                { q: '9 √ó 3 = ?', a: '27' },
                { q: '9 √ó 4 = ?', a: '36' },
                { q: '9 √ó 5 = ?', a: '45' },
                { q: '9 √ó 6 = ?', a: '54' },
                { q: '9 √ó 7 = ?', a: '63' },
                { q: '9 √ó 8 = ?', a: '72' },
                { q: '9 √ó 9 = ?', a: '81' },
                { q: '9 √ó 1 = ?', a: '9' },
                { q: '9 √ó 10 = ?', a: '90' }
            ]);
            
            // Worksheets 5-10: Mixed practice with increasing speed requirement
            for (let i = 5; i <= 10; i++) {
                const mixed = [];
                for (let j = 0; j < 10; j++) {
                    const num1 = Math.floor(Math.random() * 8) + 2;
                    const num2 = Math.floor(Math.random() * 8) + 2;
                    mixed.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(mixed);
            }
            
            return worksheets;
        }

        function generateMultiDigitWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-3: 2-digit √ó 1-digit (no carrying)
            for (let w = 0; w < 3; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = (Math.floor(Math.random() * 4) + 1) * 10 + Math.floor(Math.random() * 3);
                    const num2 = Math.floor(Math.random() * 3) + 2;
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 4-6: 2-digit √ó 1-digit (with carrying)
            for (let w = 0; w < 3; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 90) + 10;
                    const num2 = Math.floor(Math.random() * 7) + 3;
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 7-10: 3-digit √ó 1-digit
            for (let w = 0; w < 4; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 900) + 100;
                    const num2 = Math.floor(Math.random() * 8) + 2;
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        function generateDivisionWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-4: Division facts (reverse of multiplication)
            for (let w = 0; w < 4; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 7) + 3;
                    const quotient = Math.floor(Math.random() * 9) + 2;
                    const dividend = divisor * quotient;
                    ws.push({ q: `${dividend} √∑ ${divisor} = ?`, a: String(quotient) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 5-10: Division with remainders
            for (let w = 0; w < 6; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 6) + 4;
                    const quotient = Math.floor(Math.random() * 12) + 3;
                    const remainder = Math.floor(Math.random() * (divisor - 1)) + 1;
                    const dividend = divisor * quotient + remainder;
                    ws.push({ 
                        q: `${dividend} √∑ ${divisor} = ? (answer as: quotient r remainder)`, 
                        a: `${quotient} r ${remainder}` 
                    });
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        function generateLongDivisionWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-5: 2-digit divisors (no remainder)
            for (let w = 0; w < 5; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 15) + 11;
                    const quotient = Math.floor(Math.random() * 50) + 10;
                    const dividend = divisor * quotient;
                    ws.push({ q: `${dividend} √∑ ${divisor} = ?`, a: String(quotient) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 6-10: 2-digit divisors (with remainders)
            for (let w = 0; w < 5; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const divisor = Math.floor(Math.random() * 20) + 12;
                    const quotient = Math.floor(Math.random() * 40) + 15;
                    const remainder = Math.floor(Math.random() * (divisor - 1)) + 1;
                    const dividend = divisor * quotient + remainder;
                    ws.push({ 
                        q: `${dividend} √∑ ${divisor} = ? (answer as: quotient r remainder)`, 
                        a: `${quotient} r ${remainder}` 
                    });
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        function generateFractionsWorksheets() {
            const worksheets = [];
            const fractions = [
                { orig: '2/4', simp: '1/2' },
                { orig: '3/6', simp: '1/2' },
                { orig: '4/8', simp: '1/2' },
                { orig: '6/9', simp: '2/3' },
                { orig: '8/12', simp: '2/3' },
                { orig: '10/15', simp: '2/3' },
                { orig: '6/8', simp: '3/4' },
                { orig: '9/12', simp: '3/4' },
                { orig: '4/6', simp: '2/3' },
                { orig: '10/12', simp: '5/6' }
            ];
            
            // Worksheets 1-3: Simplifying fractions
            for (let w = 0; w < 3; w++) {
                const ws = fractions.map(f => ({ 
                    q: `Simplify: ${f.orig} (answer as fraction, e.g., 1/2)`, 
                    a: f.simp 
                }));
                worksheets.push(ws);
            }
            
            // Worksheets 4-5: Improper to mixed
            const improper = [
                { imp: '7/3', mix: '2 1/3' },
                { imp: '11/4', mix: '2 3/4' },
                { imp: '17/5', mix: '3 2/5' },
                { imp: '13/6', mix: '2 1/6' },
                { imp: '19/7', mix: '2 5/7' },
                { imp: '23/8', mix: '2 7/8' },
                { imp: '15/4', mix: '3 3/4' },
                { imp: '22/5', mix: '4 2/5' },
                { imp: '27/6', mix: '4 3/6' },
                { imp: '31/9', mix: '3 4/9' }
            ];
            for (let w = 0; w < 2; w++) {
                const ws = improper.map(f => ({ 
                    q: `Convert to mixed number: ${f.imp} (answer as: 2 1/3)`, 
                    a: f.mix 
                }));
                worksheets.push(ws);
            }
            
            // Worksheets 6-10: Addition/subtraction of fractions
            for (let w = 0; w < 5; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const denom = [5, 6, 7, 8, 9, 10][Math.floor(Math.random() * 6)];
                    const num1 = Math.floor(Math.random() * (denom - 2)) + 1;
                    const num2 = Math.floor(Math.random() * (denom - num1 - 1)) + 1;
                    const op = Math.random() < 0.5 ? '+' : '-';
                    const result = op === '+' ? num1 + num2 : num1 - num2;
                    if (result > 0) {
                        ws.push({ 
                            q: `${num1}/${denom} ${op} ${num2}/${denom} = ? (answer as fraction)`, 
                            a: `${result}/${denom}` 
                        });
                    } else {
                        i--;
                    }
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        function generateMultiplicationDecimalsWorksheets() {
            const worksheets = [];
            
            // Worksheets 1-4: 2-digit √ó 2-digit
            for (let w = 0; w < 4; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 50) + 20;
                    const num2 = Math.floor(Math.random() * 50) + 20;
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 5-7: 3-digit √ó 2-digit
            for (let w = 0; w < 3; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    const num1 = Math.floor(Math.random() * 500) + 200;
                    const num2 = Math.floor(Math.random() * 50) + 20;
                    ws.push({ q: `${num1} √ó ${num2} = ?`, a: String(num1 * num2) });
                }
                worksheets.push(ws);
            }
            
            // Worksheets 8-10: Decimals
            for (let w = 0; w < 3; w++) {
                const ws = [];
                for (let i = 0; i < 10; i++) {
                    if (Math.random() < 0.5) {
                        const num1 = (Math.floor(Math.random() * 90) + 10) / 10;
                        const num2 = (Math.floor(Math.random() * 90) + 10) / 10;
                        const result = (num1 + num2).toFixed(1);
                        ws.push({ q: `${num1} + ${num2} = ?`, a: result });
                    } else {
                        const num1 = (Math.floor(Math.random() * 90) + 20) / 10;
                        const num2 = (Math.floor(Math.random() * 50) + 10) / 10;
                        const result = (num1 - num2).toFixed(1);
                        ws.push({ q: `${num1} - ${num2} = ?`, a: result });
                    }
                }
                worksheets.push(ws);
            }
            
            return worksheets;
        }

        const readingContent = {
            'C': [
                {
                    title: 'The Water Cycle',
                    passage: `Water on Earth is constantly moving through a process called the water cycle. This cycle has been happening for billions of years and is essential for all life on our planet.

The water cycle begins with evaporation. When the Sun heats up water in rivers, lakes, and oceans, some of it turns into water vapor and rises into the air. Plants also release water vapor through a process called transpiration.

As the water vapor rises higher into the atmosphere, it cools down and condenses into tiny water droplets, forming clouds. This process is called condensation. When the droplets become heavy enough, they fall back to Earth as precipitation‚Äîrain, snow, sleet, or hail.

When precipitation falls on land, some of it flows into streams and rivers, eventually reaching the ocean. This is called runoff. Some water also seeps into the ground, becoming groundwater that plants and trees can use. The cycle then begins again with evaporation.`,
                    questions: [
                        { type: 'multiple', question: 'What causes water to evaporate?', options: ['Wind', 'The Sun', 'Clouds', 'Rain'], answer: 'The Sun' },
                        { type: 'multiple', question: 'What is the process of water vapor turning into clouds called?', options: ['Evaporation', 'Precipitation', 'Condensation', 'Transpiration'], answer: 'Condensation' },
                        { type: 'multiple', question: 'Which of these is NOT a form of precipitation?', options: ['Rain', 'Snow', 'Fog', 'Hail'], answer: 'Fog' },
                        { type: 'input', question: 'What is water that seeps into the ground called? (one word)', answer: 'groundwater' },
                        { type: 'multiple', question: 'What process do plants use to release water vapor?', options: ['Evaporation', 'Condensation', 'Transpiration', 'Precipitation'], answer: 'Transpiration' },
                    ]
                },
                {
                    title: 'Benjamin Franklin',
                    passage: `Benjamin Franklin was one of the most remarkable people in American history. Born in 1706 in Boston, he became famous as an inventor, writer, scientist, and statesman.

As a young man, Franklin worked as a printer and started his own newspaper. He became known for his witty sayings like "Early to bed and early to rise makes a man healthy, wealthy, and wise." He published these sayings in a book called Poor Richard's Almanack.

Franklin was also a brilliant inventor. He invented the lightning rod, which protects buildings from lightning strikes. He also created bifocal glasses, which help people see both near and far. He never patented his inventions because he believed they should benefit everyone.

In his later years, Franklin helped write the Declaration of Independence and the United States Constitution. He also served as an ambassador to France, helping to secure French support during the American Revolution. Franklin died in 1790 at the age of 84, leaving behind a legacy of innovation and service.`,
                    questions: [
                        { type: 'multiple', question: 'What was Benjamin Franklin\'s first job?', options: ['Inventor', 'Printer', 'Politician', 'Teacher'], answer: 'Printer' },
                        { type: 'multiple', question: 'What book did Franklin publish with witty sayings?', options: ['The Constitution', 'Poor Richard\'s Almanack', 'The Declaration', 'Boston Times'], answer: 'Poor Richard\'s Almanack' },
                        { type: 'multiple', question: 'What protects buildings from lightning?', options: ['Bifocals', 'Lightning rod', 'Newspaper', 'Almanack'], answer: 'Lightning rod' },
                        { type: 'multiple', question: 'Why didn\'t Franklin patent his inventions?', options: ['He forgot', 'He was too busy', 'He wanted everyone to benefit', 'They weren\'t important'], answer: 'He wanted everyone to benefit' },
                        { type: 'input', question: 'What country did Franklin serve as ambassador to? (one word)', answer: 'France' },
                    ]
                }
            ],
            'D': [
                {
                    title: 'Photosynthesis: How Plants Make Food',
                    passage: `Have you ever wondered how plants make their own food? Unlike animals, plants don't need to eat other organisms to survive. Instead, they create their own food through a remarkable process called photosynthesis.

Photosynthesis occurs mainly in the leaves of plants. Leaves contain millions of tiny structures called chloroplasts, which give plants their green color. Inside chloroplasts is a pigment called chlorophyll that captures energy from sunlight.

The process begins when plants absorb water through their roots and carbon dioxide from the air through tiny pores called stomata. Using the energy captured by chlorophyll, plants combine water and carbon dioxide to produce glucose (a type of sugar) and oxygen.

The glucose produced provides energy for the plant to grow and carry out life processes. The oxygen is released into the air as a waste product‚Äîwhich is fortunate for us because we need oxygen to breathe! In fact, plants produce most of the oxygen in Earth's atmosphere.

Photosynthesis is essential for life on Earth. It forms the foundation of most food chains, as plants are eaten by herbivores, which are in turn eaten by carnivores. Without photosynthesis, life as we know it could not exist.`,
                    questions: [
                        { type: 'multiple', question: 'Where does photosynthesis mainly occur in plants?', options: ['Roots', 'Stems', 'Leaves', 'Flowers'], answer: 'Leaves' },
                        { type: 'multiple', question: 'What gives plants their green color?', options: ['Glucose', 'Oxygen', 'Chlorophyll', 'Stomata'], answer: 'Chlorophyll' },
                        { type: 'input', question: 'What are the tiny pores that absorb carbon dioxide called? (one word)', answer: 'stomata' },
                        { type: 'multiple', question: 'What type of sugar do plants produce?', options: ['Fructose', 'Glucose', 'Sucrose', 'Lactose'], answer: 'Glucose' },
                        { type: 'multiple', question: 'What "waste product" do plants release that we need?', options: ['Carbon dioxide', 'Water', 'Glucose', 'Oxygen'], answer: 'Oxygen' },
                    ]
                },
                {
                    title: 'The Journey of the Mayflower',
                    passage: `In September 1620, a small ship called the Mayflower set sail from Plymouth, England, carrying 102 passengers. These passengers, known as Pilgrims, were seeking religious freedom and a new life in America. They faced a dangerous journey across the Atlantic Ocean that would change the course of history.

The voyage was extremely difficult. The ship was only about 100 feet long‚Äîroughly the size of a modern volleyball court‚Äîand was packed with passengers, crew, supplies, and even farm animals. Storms battered the vessel, and one main beam cracked during the journey. The passengers were seasick and frightened, but they pressed on.

After 66 days at sea, the Mayflower finally reached land in November 1620. However, they had been blown off course and arrived at Cape Cod in present-day Massachusetts instead of their intended destination near the Hudson River. The Pilgrims decided to settle there and established Plymouth Colony.

Before leaving the ship, the male passengers signed an agreement called the Mayflower Compact. This document established a government based on majority rule and is considered one of the first examples of self-government in America. It stated that they would create "just and equal laws" for the good of the colony.

The first winter was brutal. Nearly half of the Pilgrims died from disease and harsh conditions. However, with help from the Wampanoag people, particularly a man named Squanto, the survivors learned to farm in their new land. In autumn 1621, they celebrated their first successful harvest with a feast of thanksgiving‚Äîan event that became the foundation for the American holiday of Thanksgiving.`,
                    questions: [
                        { type: 'input', question: 'How many passengers were on the Mayflower? (number only)', answer: '102' },
                        { type: 'multiple', question: 'How long did the voyage take?', options: ['40 days', '50 days', '66 days', '80 days'], answer: '66 days' },
                        { type: 'multiple', question: 'Where did the Pilgrims originally intend to land?', options: ['Cape Cod', 'Plymouth', 'Near the Hudson River', 'Boston'], answer: 'Near the Hudson River' },
                        { type: 'input', question: 'What was the name of the document signed before leaving the ship? (two words, capitalized)', answer: 'Mayflower Compact' },
                        { type: 'multiple', question: 'About how many Pilgrims survived the first winter?', options: ['All of them', 'About half', 'Only a few', 'None of them'], answer: 'About half' },
                    ]
                }
            ]
        };

        function selectGrade(grade) {
            currentGrade = grade;
            document.querySelectorAll('.grade-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.grade-btn').classList.add('active');
            document.getElementById('subjectSelector').classList.remove('hidden');
        }

        function selectSubject(subject) {
            currentSubject = subject;
            document.querySelectorAll('.subject-card').forEach(card => card.classList.remove('active'));
            event.target.closest('.subject-card').classList.add('active');
            
            setTimeout(() => {
                if (subject === 'math') {
                    showWorksheetSelector();
                } else {
                    generateReadingWorksheet();
                }
            }, 300);
        }

        function showWorksheetSelector() {
            document.getElementById('subjectSelector').classList.add('hidden');
            document.getElementById('worksheetSelector').classList.remove('hidden');
            
            const worksheetList = document.getElementById('worksheetList');
            worksheetList.innerHTML = '';
            
            const sublevels = Object.keys(mathWorksheets[currentGrade]);
            
            sublevels.forEach(sublevel => {
                const section = document.createElement('div');
                section.className = 'sublevel-section';
                
                const title = document.createElement('div');
                title.className = 'sublevel-title';
                title.textContent = sublevel;
                section.appendChild(title);
                
                const grid = document.createElement('div');
                grid.className = 'worksheet-grid';
                
                for (let i = 1; i <= 10; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'worksheet-btn';
                    btn.textContent = `#${i}`;
                    const wsKey = `${currentGrade}-${sublevel}-${i}`;
                    if (completedWorksheets[wsKey]) {
                        btn.classList.add('completed');
                        btn.textContent += ' ‚úì';
                    }
                    btn.onclick = () => selectWorksheet(sublevel, i);
                    grid.appendChild(btn);
                }
                
                section.appendChild(grid);
                worksheetList.appendChild(section);
            });
            
            document.getElementById('worksheetSelector').scrollIntoView({ behavior: 'smooth' });
        }

        function selectWorksheet(sublevel, worksheetNum) {
            currentSublevel = sublevel;
            currentWorksheetNum = worksheetNum;
            generateMathWorksheet();
        }

        function generateMathWorksheet() {
            checkedOnce = false;
            userAnswers = {};
            
            const worksheetArea = document.getElementById('worksheetArea');
            const questionsContainer = document.getElementById('questionsContainer');
            const worksheetTitle = document.getElementById('worksheetTitle');
            
            document.getElementById('worksheetSelector').classList.add('hidden');
            worksheetArea.classList.remove('hidden');
            
            questionsContainer.innerHTML = '';
            clearCanvas();
            
            worksheetTitle.textContent = `Level ${currentGrade} - ${currentSublevel} - Worksheet ${currentWorksheetNum}`;
            
            const worksheet = mathWorksheets[currentGrade][currentSublevel][currentWorksheetNum - 1];
            currentQuestions = worksheet.map(item => ({
                type: 'input',
                question: item.q,
                answer: item.a,
                category: currentSublevel
            }));
            
            renderMathQuestions();
            updateProgress();
            
            worksheetArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            initCanvas();
        }

        function generateReadingWorksheet() {
            checkedOnce = false;
            userAnswers = {};
            
            const worksheetArea = document.getElementById('worksheetArea');
            const questionsContainer = document.getElementById('questionsContainer');
            const worksheetTitle = document.getElementById('worksheetTitle');
            
            document.getElementById('subjectSelector').classList.add('hidden');
            worksheetArea.classList.remove('hidden');
            
            questionsContainer.innerHTML = '';
            clearCanvas();
            
            worksheetTitle.textContent = `Level ${currentGrade} Reading Comprehension`;
            const readingSet = readingContent[currentGrade][Math.floor(Math.random() * readingContent[currentGrade].length)];
            currentQuestions = readingSet.questions;
            renderReadingQuestions(readingSet);
            
            updateProgress();
            worksheetArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            initCanvas();
        }

        function renderMathQuestions() {
            const container = document.getElementById('questionsContainer');
            
            currentQuestions.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-number">Question ${index + 1} ${q.category ? `<span style="opacity: 0.7; font-size: 0.85em;">‚Ä¢ ${q.category}</span>` : ''}</div>
                    <div class="question-text">${q.question}</div>
                    <input type="text" class="answer-input" id="answer-${index}" 
                         placeholder="Type your answer here..."
                         onchange="saveAnswer(${index}, this.value)">
                    <div id="feedback-${index}"></div>
                `;
                container.appendChild(questionCard);
            });
        }

        function renderReadingQuestions(readingSet) {
            const container = document.getElementById('questionsContainer');
            
            const passageDiv = document.createElement('div');
            passageDiv.className = 'reading-passage';
            passageDiv.innerHTML = `
                <h3>${readingSet.title}</h3>
                ${readingSet.passage.split('\n\n').map(p => `<p>${p}</p>`).join('')}
            `;
            container.appendChild(passageDiv);
            
            currentQuestions.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-number">Question ${index + 1}</div>
                    <div class="question-text">${q.question}</div>
                    ${q.type === 'input' 
                        ? `<input type="text" class="answer-input" id="answer-${index}" 
                             placeholder="Type your answer here..."
                             onchange="saveAnswer(${index}, this.value)">`
                        : `<div class="options-container">
                             ${q.options.map((opt, i) => 
                                `<button class="option-btn" onclick="selectOption(${index}, '${opt}', this)">
                                    ${opt}
                                 </button>`
                             ).join('')}
                           </div>`
                    }
                    <div id="feedback-${index}"></div>
                `;
                container.appendChild(questionCard);
            });
        }

        function saveAnswer(questionIndex, answer) {
            userAnswers[questionIndex] = answer.trim();
        }

        function selectOption(questionIndex, option, button) {
            const container = button.parentElement;
            container.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
            userAnswers[questionIndex] = option;
        }

        function checkAnswers() {
            let correctCount = 0;
            
            currentQuestions.forEach((q, index) => {
                const userAnswer = userAnswers[index];
                const feedbackDiv = document.getElementById(`feedback-${index}`);
                const inputElement = document.getElementById(`answer-${index}`);
                
                if (!userAnswer) {
                    feedbackDiv.innerHTML = '<div class="feedback-message incorrect">‚ö†Ô∏è Please answer this question!</div>';
                    return;
                }
                
                const isCorrect = checkAnswer(userAnswer, q.answer);
                
                if (isCorrect) {
                    correctCount++;
                    feedbackDiv.innerHTML = '<div class="feedback-message correct">‚ú® Excellent! That\'s correct!</div>';
                    if (inputElement) {
                        inputElement.classList.add('correct');
                        inputElement.classList.remove('incorrect');
                    }
                    highlightCorrectOption(index, q.answer);
                } else {
                    feedbackDiv.innerHTML = `<div class="feedback-message incorrect">üí° Not quite. The answer is: ${q.answer}</div>`;
                    if (inputElement) {
                        inputElement.classList.add('incorrect');
                        inputElement.classList.remove('correct');
                    }
                    highlightIncorrectOption(index, userAnswer, q.answer);
                }
            });
            
            updateProgress(correctCount);
            
            if (correctCount === currentQuestions.length && currentSubject === 'math') {
                const wsKey = `${currentGrade}-${currentSublevel}-${currentWorksheetNum}`;
                completedWorksheets[wsKey] = true;
            }
            
            if (correctCount === currentQuestions.length) {
                setTimeout(() => {
                    showCompletionScreen(correctCount);
                }, 1500);
            }
            
            checkedOnce = true;
        }

        function checkAnswer(userAnswer, correctAnswer) {
            const normalizeAnswer = (ans) => {
                return ans.toString().toLowerCase().replace(/[^a-z0-9./\s]/g, '').trim();
            };
            return normalizeAnswer(userAnswer) === normalizeAnswer(correctAnswer);
        }

        function highlightCorrectOption(questionIndex, correctAnswer) {
            const container = document.getElementById(`feedback-${questionIndex}`).parentElement;
            const buttons = container.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                if (btn.textContent.trim() === correctAnswer) {
                    btn.classList.add('correct');
                }
            });
        }

        function highlightIncorrectOption(questionIndex, userAnswer, correctAnswer) {
            const container = document.getElementById(`feedback-${questionIndex}`).parentElement;
            const buttons = container.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                const btnText = btn.textContent.trim();
                if (btnText === userAnswer) {
                    btn.classList.add('incorrect');
                }
                if (btnText === correctAnswer) {
                    btn.classList.add('correct');
                }
            });
        }

        function updateProgress(correct = 0) {
            const answered = Object.keys(userAnswers).length;
            const total = currentQuestions.length;
            
            document.getElementById('progressText').textContent = `${answered}/${total}`;
            document.getElementById('progressFill').style.width = `${(answered / total) * 100}%`;
            
            if (correct > 0) {
                const stars = '‚≠ê'.repeat(Math.min(correct, 10));
                document.getElementById('starsEarned').textContent = stars;
            }
        }

        function showCompletionScreen(score) {
            const container = document.getElementById('questionsContainer');
            const total = currentQuestions.length;
            const percentage = (score / total) * 100;
            
            let message = '';
            let emoji = '';
            
            if (percentage === 100) {
                message = 'Perfect Score!';
                emoji = 'üèÜ';
            } else if (percentage >= 80) {
                message = 'Great Job!';
                emoji = 'üåü';
            } else if (percentage >= 60) {
                message = 'Good Work!';
                emoji = 'üëç';
            } else {
                message = 'Keep Practicing!';
                emoji = 'üí™';
            }
            
            container.innerHTML = `
                <div class="completion-screen">
                    <h2>${message}</h2>
                    <div class="star-animation">${emoji}</div>
                    <div class="score-display">${score}/${total}</div>
                    <p style="font-size: 1.3em; color: var(--text-light); margin: 20px 0;">
                        You got ${percentage.toFixed(0)}% correct!
                    </p>
                </div>
            `;
        }

        function backToWorksheetList() {
            document.getElementById('worksheetArea').classList.add('hidden');
            if (currentSubject === 'math') {
                showWorksheetSelector();
            } else {
                document.getElementById('subjectSelector').classList.remove('hidden');
            }
            document.getElementById('starsEarned').textContent = '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function backToMenu() {
            document.getElementById('worksheetArea').classList.add('hidden');
            document.getElementById('worksheetSelector').classList.add('hidden');
            document.getElementById('subjectSelector').classList.remove('hidden');
            document.getElementById('starsEarned').textContent = '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            if (document.getElementById('scratchCanvas')) {
                initCanvas();
            }
        });
    </script>
</body>
</html>