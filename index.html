<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn & Grow - Math & Reading Practice</title>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --accent: #FFE66D;
            --success: #95E1D3;
            --purple: #A8E6CF;
            --orange: #FFB347;
            --bg-main: #FFF9F0;
            --text-dark: #2C3E50;
            --text-light: #7F8C8D;
            --shadow: 0 8px 24px rgba(0,0,0,0.12);
            --shadow-sm: 0 4px 12px rgba(0,0,0,0.08);
        }

        body {
            font-family: 'Baloo 2', cursive;
            background: linear-gradient(135deg, #FFF9F0 0%, #FFE8D6 100%);
            min-height: 100vh;
            color: var(--text-dark);
            padding: 20px;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: 3em;
            color: var(--primary);
            text-shadow: 3px 3px 0 var(--accent);
            margin-bottom: 10px;
            font-weight: 800;
        }

        .header p {
            font-size: 1.2em;
            color: var(--text-light);
        }

        .student-selector {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .student-selector h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .grade-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .grade-btn {
            flex: 1;
            min-width: 200px;
            padding: 30px;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--purple) 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.3em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            font-family: 'Baloo 2', cursive;
        }

        .grade-btn:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .grade-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--orange) 100%);
            transform: scale(1.05);
        }

        .subject-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease-out 0.4s both;
        }

        .subject-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            border: 3px solid transparent;
        }

        .subject-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow);
        }

        .subject-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, #FFF 0%, #FFE8D6 100%);
        }

        .subject-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .subject-card h3 {
            font-size: 1.5em;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .subject-card p {
            color: var(--text-light);
        }

        .worksheet-area {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease-out 0.6s both;
        }

        .worksheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .worksheet-title {
            font-size: 2em;
            color: var(--primary);
            font-weight: 700;
        }

        .progress-container {
            flex: 1;
            min-width: 200px;
        }

        .progress-label {
            font-size: 0.9em;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 20px;
            background: #E8E8E8;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary) 0%, var(--success) 100%);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .stars-earned {
            text-align: center;
            font-size: 2em;
            margin-top: 10px;
        }

        .question-card {
            background: linear-gradient(135deg, #F8F9FA 0%, #FFFFFF 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            border-left: 5px solid var(--secondary);
            transition: all 0.3s ease;
        }

        .question-card:hover {
            box-shadow: var(--shadow-sm);
            transform: translateX(5px);
        }

        .question-number {
            display: inline-block;
            background: var(--accent);
            color: var(--text-dark);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .question-text {
            font-size: 1.3em;
            color: var(--text-dark);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #E8E8E8;
            border-radius: 10px;
            font-family: 'Comic Neue', cursive;
            transition: all 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        .answer-input.correct {
            border-color: var(--success);
            background: #F0FFF4;
        }

        .answer-input.incorrect {
            border-color: var(--primary);
            background: #FFF5F5;
        }

        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .option-btn {
            padding: 20px;
            background: white;
            border: 3px solid #E8E8E8;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Baloo 2', cursive;
            font-weight: 600;
        }

        .option-btn:hover {
            border-color: var(--secondary);
            transform: scale(1.05);
        }

        .option-btn.selected {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .option-btn.correct {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .option-btn.incorrect {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 18px 40px;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Baloo 2', cursive;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--purple) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: white;
            color: var(--text-dark);
            border: 3px solid var(--secondary);
        }

        .btn-secondary:hover {
            background: var(--secondary);
            color: white;
        }

        .feedback-message {
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            font-size: 1.1em;
            font-weight: 600;
            text-align: center;
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .feedback-message.correct {
            background: var(--success);
            color: white;
        }

        .feedback-message.incorrect {
            background: #FFE8E8;
            color: var(--primary);
        }

        .completion-screen {
            text-align: center;
            padding: 60px 20px;
        }

        .completion-screen h2 {
            font-size: 3em;
            color: var(--primary);
            margin-bottom: 20px;
            animation: bounceIn 0.8s ease;
        }

        .score-display {
            font-size: 4em;
            color: var(--secondary);
            margin: 30px 0;
            font-weight: 800;
            animation: bounceIn 1s ease 0.2s both;
        }

        .star-animation {
            font-size: 6em;
            margin: 20px 0;
            animation: starPulse 1.5s ease infinite;
        }

        @keyframes starPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }

        .reading-passage {
            background: #FFFEF9;
            border: 3px solid var(--accent);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            line-height: 2;
            font-size: 1.15em;
            font-family: 'Comic Neue', cursive;
        }

        .reading-passage h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .reading-passage p {
            margin-bottom: 20px;
            color: var(--text-dark);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .worksheet-header {
                flex-direction: column;
            }
            
            .grade-buttons {
                flex-direction: column;
            }
            
            .subject-selector {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>üìö Learn & Grow üåü</h1>
            <p>Practice makes perfect! Let's learn together.</p>
        </div>

        <div class="student-selector">
            <h2>Select Your Grade</h2>
            <div class="grade-buttons">
                <button class="grade-btn" onclick="selectGrade(3)">
                    üéí 3rd Grade
                </button>
                <button class="grade-btn" onclick="selectGrade(5)">
                    üìñ 5th Grade
                </button>
            </div>
        </div>

        <div id="subjectSelector" class="subject-selector hidden">
            <div class="subject-card" onclick="selectSubject('math')">
                <div class="subject-icon">üî¢</div>
                <h3>Math Practice</h3>
                <p>Numbers, operations, and problem solving</p>
            </div>
            <div class="subject-card" onclick="selectSubject('reading')">
                <div class="subject-icon">üìñ</div>
                <h3>Reading Practice</h3>
                <p>Comprehension and vocabulary</p>
            </div>
        </div>

        <div id="worksheetArea" class="worksheet-area hidden">
            <div class="worksheet-header">
                <div class="worksheet-title" id="worksheetTitle"></div>
                <div class="progress-container">
                    <div class="progress-label">Progress: <span id="progressText">0/10</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="stars-earned" id="starsEarned"></div>
                </div>
            </div>

            <div id="questionsContainer"></div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="checkAnswers()">Check My Answers ‚úì</button>
                <button class="btn btn-secondary" onclick="newWorksheet()">New Worksheet üîÑ</button>
                <button class="btn btn-secondary" onclick="backToMenu()">Back to Menu üè†</button>
            </div>
        </div>
    </div>

    <script>
        let currentGrade = null;
        let currentSubject = null;
        let currentQuestions = [];
        let userAnswers = {};
        let checkedOnce = false;

        const mathProblems = {
            3: [
                // Addition and Subtraction
                { type: 'input', question: '145 + 278 = ?', answer: '423' },
                { type: 'input', question: '562 - 189 = ?', answer: '373' },
                { type: 'input', question: '89 + 456 = ?', answer: '545' },
                { type: 'input', question: '723 - 398 = ?', answer: '325' },
                // Multiplication
                { type: 'input', question: '7 √ó 8 = ?', answer: '56' },
                { type: 'input', question: '9 √ó 6 = ?', answer: '54' },
                { type: 'input', question: '12 √ó 5 = ?', answer: '60' },
                // Division
                { type: 'input', question: '48 √∑ 6 = ?', answer: '8' },
                { type: 'input', question: '63 √∑ 7 = ?', answer: '9' },
                { type: 'input', question: '72 √∑ 8 = ?', answer: '9' },
                // Word Problems
                { type: 'input', question: 'Sarah has 24 apples. She gives 8 to her friend. How many apples does she have left?', answer: '16' },
                { type: 'input', question: 'A box contains 6 pencils. How many pencils are in 7 boxes?', answer: '42' },
                { type: 'multiple', question: 'What is the next number in the pattern? 5, 10, 15, 20, ___', options: ['23', '25', '30', '35'], answer: '25' },
                { type: 'multiple', question: 'Which fraction is equal to one half?', options: ['2/4', '1/3', '3/5', '2/5'], answer: '2/4' },
                { type: 'input', question: 'What is 5 √ó 9?', answer: '45' },
            ],
            5: [
                // Multi-digit operations
                { type: 'input', question: '3,456 + 2,789 = ?', answer: '6245' },
                { type: 'input', question: '5,832 - 2,967 = ?', answer: '2865' },
                { type: 'input', question: '345 √ó 6 = ?', answer: '2070' },
                { type: 'input', question: '144 √∑ 12 = ?', answer: '12' },
                // Decimals
                { type: 'input', question: '3.5 + 2.8 = ?', answer: '6.3' },
                { type: 'input', question: '8.9 - 3.4 = ?', answer: '5.5' },
                // Fractions
                { type: 'multiple', question: 'What is 1/4 + 1/4?', options: ['1/8', '1/2', '2/8', '2/4'], answer: '1/2' },
                { type: 'multiple', question: 'What is 3/5 of 20?', options: ['10', '12', '15', '18'], answer: '12' },
                // Word Problems
                { type: 'input', question: 'A rectangle has a length of 12 cm and width of 8 cm. What is its area in square cm?', answer: '96' },
                { type: 'input', question: 'If a book costs $15.75 and you pay with a $20 bill, how much change do you get?', answer: '4.25' },
                { type: 'multiple', question: 'What is the perimeter of a square with sides of 7 inches?', options: ['14 inches', '21 inches', '28 inches', '49 inches'], answer: '28 inches' },
                { type: 'input', question: 'What is 25% of 80?', answer: '20' },
                { type: 'input', question: '15 √ó 12 = ?', answer: '180' },
                { type: 'input', question: 'What is 0.6 √ó 10?', answer: '6' },
                { type: 'multiple', question: 'Which is larger: 0.7 or 0.65?', options: ['0.7', '0.65', 'They are equal', 'Cannot determine'], answer: '0.7' },
            ]
        };

        const readingContent = {
            3: [
                {
                    title: 'The Curious Raccoon',
                    passage: `Rocky the raccoon lived near a small pond in the forest. Every night, he would wash his food in the water before eating it. One evening, Rocky found a shiny coin by the pond. He tried to wash it just like his food, but the coin slipped from his paws and fell into the water.

Rocky looked into the pond, but he couldn't see the coin anymore. He felt sad. Just then, a wise old turtle swam up to him. "Don't worry," said the turtle. "I saw where your coin fell. It's resting on a lily pad." The turtle helped Rocky get his coin back.

From that day on, Rocky was more careful with his treasures. He also made a new friend in the turtle. They would often meet by the pond and share stories about their day.`,
                    questions: [
                        { type: 'multiple', question: 'Where did Rocky the raccoon live?', options: ['In a cave', 'Near a pond', 'In a tree', 'In a burrow'], answer: 'Near a pond' },
                        { type: 'multiple', question: 'What did Rocky find by the pond?', options: ['A shiny coin', 'A fish', 'A acorn', 'A shell'], answer: 'A shiny coin' },
                        { type: 'multiple', question: 'Who helped Rocky find his coin?', options: ['A bird', 'A turtle', 'A fish', 'A frog'], answer: 'A turtle' },
                        { type: 'multiple', question: 'What did Rocky do before eating his food?', options: ['Cooked it', 'Washed it', 'Shared it', 'Hid it'], answer: 'Washed it' },
                        { type: 'input', question: 'What lesson did Rocky learn? (Use 1-2 words)', answer: 'be careful' },
                    ]
                },
                {
                    title: 'The Solar System',
                    passage: `Our solar system is like a big neighborhood in space. At the center is the Sun, which is actually a star. The Sun gives us light and warmth.

Eight planets orbit around the Sun. The four planets closest to the Sun are called the inner planets: Mercury, Venus, Earth, and Mars. These planets are made mostly of rock. Earth is the third planet from the Sun and the only one where we know life exists.

The four planets farthest from the Sun are called the outer planets: Jupiter, Saturn, Uranus, and Neptune. These planets are much bigger and are made mostly of gas. Saturn is famous for its beautiful rings made of ice and rock.`,
                    questions: [
                        { type: 'multiple', question: 'What is at the center of our solar system?', options: ['Earth', 'The Moon', 'The Sun', 'Jupiter'], answer: 'The Sun' },
                        { type: 'multiple', question: 'How many planets orbit the Sun?', options: ['Six', 'Seven', 'Eight', 'Nine'], answer: 'Eight' },
                        { type: 'multiple', question: 'What are the inner planets made of?', options: ['Gas', 'Rock', 'Ice', 'Water'], answer: 'Rock' },
                        { type: 'multiple', question: 'Which planet is famous for its rings?', options: ['Jupiter', 'Saturn', 'Uranus', 'Neptune'], answer: 'Saturn' },
                        { type: 'multiple', question: 'What is Earth\'s position from the Sun?', options: ['First', 'Second', 'Third', 'Fourth'], answer: 'Third' },
                    ]
                }
            ],
            5: [
                {
                    title: 'The Water Cycle',
                    passage: `Water on Earth is constantly moving through a process called the water cycle. This cycle has been happening for billions of years and is essential for all life on our planet.

The water cycle begins with evaporation. When the Sun heats up water in rivers, lakes, and oceans, some of it turns into water vapor and rises into the air. Plants also release water vapor through a process called transpiration.

As the water vapor rises higher into the atmosphere, it cools down and condenses into tiny water droplets, forming clouds. This process is called condensation. When the droplets become heavy enough, they fall back to Earth as precipitation‚Äîrain, snow, sleet, or hail.

When precipitation falls on land, some of it flows into streams and rivers, eventually reaching the ocean. This is called runoff. Some water also seeps into the ground, becoming groundwater that plants and trees can use. The cycle then begins again with evaporation.

Understanding the water cycle helps us appreciate how water is recycled in nature and why it's important to protect our water resources.`,
                    questions: [
                        { type: 'multiple', question: 'What causes water to evaporate?', options: ['Wind', 'The Sun', 'Clouds', 'Rain'], answer: 'The Sun' },
                        { type: 'multiple', question: 'What is the process of water vapor turning into clouds called?', options: ['Evaporation', 'Precipitation', 'Condensation', 'Transpiration'], answer: 'Condensation' },
                        { type: 'multiple', question: 'Which of these is NOT a form of precipitation?', options: ['Rain', 'Snow', 'Fog', 'Hail'], answer: 'Fog' },
                        { type: 'input', question: 'What is water that seeps into the ground called? (one word)', answer: 'groundwater' },
                        { type: 'multiple', question: 'What process do plants use to release water vapor?', options: ['Evaporation', 'Condensation', 'Transpiration', 'Precipitation'], answer: 'Transpiration' },
                    ]
                },
                {
                    title: 'The Ancient Egyptians',
                    passage: `Ancient Egypt was one of the most powerful civilizations in history, lasting for over 3,000 years. The Egyptian civilization developed along the Nile River in northeastern Africa around 3100 BCE.

The Nile River was crucial to Egyptian life. Every year, the river would flood, depositing rich, fertile soil on the land. This allowed the Egyptians to grow crops like wheat and barley. The Nile also served as a major transportation route for trade and travel.

The ancient Egyptians are famous for building massive pyramids as tombs for their pharaohs, or kings. The largest pyramid, the Great Pyramid of Giza, was built around 2560 BCE and is one of the Seven Wonders of the Ancient World. It took thousands of workers about 20 years to build.

Egyptians developed one of the earliest forms of writing called hieroglyphics, using pictures and symbols to represent words and sounds. They also made advances in mathematics, medicine, and engineering. Their mummification process helped preserve bodies for thousands of years.

The legacy of ancient Egypt continues to fascinate people today, and archaeologists are still making new discoveries about this remarkable civilization.`,
                    questions: [
                        { type: 'multiple', question: 'How long did ancient Egyptian civilization last?', options: ['500 years', '1,000 years', '2,000 years', 'Over 3,000 years'], answer: 'Over 3,000 years' },
                        { type: 'multiple', question: 'Why was the Nile River important to Egyptians?', options: ['It provided water and fertile soil', 'It protected them from enemies', 'It was used for ceremonies', 'It contained gold'], answer: 'It provided water and fertile soil' },
                        { type: 'input', question: 'What were Egyptian kings called? (one word)', answer: 'pharaohs' },
                        { type: 'multiple', question: 'What was the Egyptian system of writing called?', options: ['Alphabet', 'Hieroglyphics', 'Cuneiform', 'Calligraphy'], answer: 'Hieroglyphics' },
                        { type: 'multiple', question: 'About how long did it take to build the Great Pyramid?', options: ['5 years', '10 years', '20 years', '50 years'], answer: '20 years' },
                    ]
                }
            ]
        };

        function selectGrade(grade) {
            currentGrade = grade;
            document.querySelectorAll('.grade-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('subjectSelector').classList.remove('hidden');
        }

        function selectSubject(subject) {
            currentSubject = subject;
            document.querySelectorAll('.subject-card').forEach(card => card.classList.remove('active'));
            event.target.closest('.subject-card').classList.add('active');
            
            setTimeout(() => {
                generateWorksheet();
            }, 300);
        }

        function generateWorksheet() {
            checkedOnce = false;
            userAnswers = {};
            
            const worksheetArea = document.getElementById('worksheetArea');
            const questionsContainer = document.getElementById('questionsContainer');
            const worksheetTitle = document.getElementById('worksheetTitle');
            
            worksheetArea.classList.remove('hidden');
            questionsContainer.innerHTML = '';
            
            if (currentSubject === 'math') {
                worksheetTitle.textContent = `Grade ${currentGrade} Math Practice`;
                currentQuestions = getRandomQuestions(mathProblems[currentGrade], 10);
                renderMathQuestions();
            } else {
                worksheetTitle.textContent = `Grade ${currentGrade} Reading Comprehension`;
                const readingSet = readingContent[currentGrade][Math.floor(Math.random() * readingContent[currentGrade].length)];
                currentQuestions = readingSet.questions;
                renderReadingQuestions(readingSet);
            }
            
            updateProgress();
            
            worksheetArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function getRandomQuestions(questions, count) {
            const shuffled = [...questions].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, Math.min(count, questions.length));
        }

        function renderMathQuestions() {
            const container = document.getElementById('questionsContainer');
            
            currentQuestions.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-number">Question ${index + 1}</div>
                    <div class="question-text">${q.question}</div>
                    ${q.type === 'input' 
                        ? `<input type="text" class="answer-input" id="answer-${index}" 
                             placeholder="Type your answer here..."
                             onchange="saveAnswer(${index}, this.value)">`
                        : `<div class="options-container">
                             ${q.options.map((opt, i) => 
                                `<button class="option-btn" onclick="selectOption(${index}, '${opt}', this)">
                                    ${opt}
                                 </button>`
                             ).join('')}
                           </div>`
                    }
                    <div id="feedback-${index}"></div>
                `;
                container.appendChild(questionCard);
            });
        }

        function renderReadingQuestions(readingSet) {
            const container = document.getElementById('questionsContainer');
            
            const passageDiv = document.createElement('div');
            passageDiv.className = 'reading-passage';
            passageDiv.innerHTML = `
                <h3>${readingSet.title}</h3>
                ${readingSet.passage.split('\n\n').map(p => `<p>${p}</p>`).join('')}
            `;
            container.appendChild(passageDiv);
            
            currentQuestions.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-number">Question ${index + 1}</div>
                    <div class="question-text">${q.question}</div>
                    ${q.type === 'input' 
                        ? `<input type="text" class="answer-input" id="answer-${index}" 
                             placeholder="Type your answer here..."
                             onchange="saveAnswer(${index}, this.value)">`
                        : `<div class="options-container">
                             ${q.options.map((opt, i) => 
                                `<button class="option-btn" onclick="selectOption(${index}, '${opt}', this)">
                                    ${opt}
                                 </button>`
                             ).join('')}
                           </div>`
                    }
                    <div id="feedback-${index}"></div>
                `;
                container.appendChild(questionCard);
            });
        }

        function saveAnswer(questionIndex, answer) {
            userAnswers[questionIndex] = answer.trim();
        }

        function selectOption(questionIndex, option, button) {
            const container = button.parentElement;
            container.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
            userAnswers[questionIndex] = option;
        }

        function checkAnswers() {
            let correctCount = 0;
            
            currentQuestions.forEach((q, index) => {
                const userAnswer = userAnswers[index];
                const feedbackDiv = document.getElementById(`feedback-${index}`);
                const inputElement = document.getElementById(`answer-${index}`);
                
                if (!userAnswer) {
                    feedbackDiv.innerHTML = '<div class="feedback-message incorrect">‚ö†Ô∏è Please answer this question!</div>';
                    return;
                }
                
                const isCorrect = checkAnswer(userAnswer, q.answer);
                
                if (isCorrect) {
                    correctCount++;
                    feedbackDiv.innerHTML = '<div class="feedback-message correct">‚ú® Excellent! That\'s correct!</div>';
                    if (inputElement) {
                        inputElement.classList.add('correct');
                        inputElement.classList.remove('incorrect');
                    }
                    highlightCorrectOption(index, q.answer);
                } else {
                    feedbackDiv.innerHTML = `<div class="feedback-message incorrect">üí° Not quite. The answer is: ${q.answer}</div>`;
                    if (inputElement) {
                        inputElement.classList.add('incorrect');
                        inputElement.classList.remove('correct');
                    }
                    highlightIncorrectOption(index, userAnswer, q.answer);
                }
            });
            
            const percentage = (correctCount / currentQuestions.length) * 100;
            updateProgress(correctCount);
            
            if (correctCount === currentQuestions.length) {
                setTimeout(() => {
                    showCompletionScreen(correctCount);
                }, 1500);
            }
            
            checkedOnce = true;
        }

        function checkAnswer(userAnswer, correctAnswer) {
            const normalizeAnswer = (ans) => {
                return ans.toString().toLowerCase().replace(/[^a-z0-9.]/g, '');
            };
            return normalizeAnswer(userAnswer) === normalizeAnswer(correctAnswer);
        }

        function highlightCorrectOption(questionIndex, correctAnswer) {
            const container = document.getElementById(`feedback-${questionIndex}`).parentElement;
            const buttons = container.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                if (btn.textContent.trim() === correctAnswer) {
                    btn.classList.add('correct');
                }
            });
        }

        function highlightIncorrectOption(questionIndex, userAnswer, correctAnswer) {
            const container = document.getElementById(`feedback-${questionIndex}`).parentElement;
            const buttons = container.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                const btnText = btn.textContent.trim();
                if (btnText === userAnswer) {
                    btn.classList.add('incorrect');
                }
                if (btnText === correctAnswer) {
                    btn.classList.add('correct');
                }
            });
        }

        function updateProgress(correct = 0) {
            const answered = Object.keys(userAnswers).length;
            const total = currentQuestions.length;
            
            document.getElementById('progressText').textContent = `${answered}/${total}`;
            document.getElementById('progressFill').style.width = `${(answered / total) * 100}%`;
            
            if (correct > 0) {
                const stars = '‚≠ê'.repeat(Math.min(correct, 10));
                document.getElementById('starsEarned').textContent = stars;
            }
        }

        function showCompletionScreen(score) {
            const container = document.getElementById('questionsContainer');
            const total = currentQuestions.length;
            const percentage = (score / total) * 100;
            
            let message = '';
            let emoji = '';
            
            if (percentage === 100) {
                message = 'Perfect Score!';
                emoji = 'üèÜ';
            } else if (percentage >= 80) {
                message = 'Great Job!';
                emoji = 'üåü';
            } else if (percentage >= 60) {
                message = 'Good Work!';
                emoji = 'üëç';
            } else {
                message = 'Keep Practicing!';
                emoji = 'üí™';
            }
            
            container.innerHTML = `
                <div class="completion-screen">
                    <h2>${message}</h2>
                    <div class="star-animation">${emoji}</div>
                    <div class="score-display">${score}/${total}</div>
                    <p style="font-size: 1.3em; color: var(--text-light); margin: 20px 0;">
                        You got ${percentage.toFixed(0)}% correct!
                    </p>
                </div>
            `;
        }

        function newWorksheet() {
            generateWorksheet();
        }

        function backToMenu() {
            document.getElementById('worksheetArea').classList.add('hidden');
            document.getElementById('subjectSelector').classList.remove('hidden');
            document.getElementById('starsEarned').textContent = '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>